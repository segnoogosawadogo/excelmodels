<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExcelModel - Mod√®les Excel Professionnels</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root{--primary:#10b981;--primary-dark:#059669;--primary-light:#d1fae5;--secondary:#06b6d4;--orange:#f59e0b;--purple:#8b5cf6;--gray-900:#111827;--gray-800:#1f2937;--gray-700:#374151;--gray-600:#4b5563;--gray-500:#6b7280;--gray-400:#9ca3af;--gray-300:#d1d5db;--gray-200:#e5e7eb;--gray-100:#f3f4f6;--gray-50:#f9fafb;--white:#fff;--danger:#dc2626;--success:#16a34a;--warning:#f59e0b;--shadow:0 1px 3px rgba(0,0,0,0.1);--shadow-md:0 4px 6px -1px rgba(0,0,0,0.1);--shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1);--radius:8px;--radius-lg:12px}
        
        /* Animations */
        @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
        .hero-badge-dot{animation:pulse 2s infinite}
        .hero-content{animation:fadeUp 0.6s ease-out}
        .category-card{transition:all 0.3s ease}
        .category-card:hover{transform:translateY(-5px);box-shadow:var(--shadow-lg)}
        .template-card{transition:all 0.3s ease}
        .template-card:hover{transform:translateY(-5px);box-shadow:var(--shadow-lg)}
        .btn{transition:all 0.2s ease}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(16,185,129,0.3)}
        *{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}body{font-family:'Inter',sans-serif;background:var(--white);color:var(--gray-800);line-height:1.6}
        .container{max-width:1280px;margin:0 auto;padding:0 24px}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 24px;border-radius:var(--radius);font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s;text-decoration:none;border:none;font-family:inherit}
        .btn-primary{background:var(--primary);color:var(--white)}.btn-primary:hover{background:var(--primary-dark)}
        .btn-outline{background:var(--white);color:var(--gray-700);border:1px solid var(--gray-300)}.btn-outline:hover{background:var(--gray-50)}
        .btn-ghost{background:transparent;color:var(--gray-600)}.btn-ghost:hover{background:var(--gray-100)}
        .btn-success{background:#25d366;color:var(--white)}.btn-danger{background:var(--danger);color:var(--white)}
        .btn-sm{padding:8px 16px;font-size:13px}.btn-lg{padding:16px 32px;font-size:16px}.btn-block{width:100%}
        .form-group{margin-bottom:20px}.form-label{display:block;margin-bottom:6px;font-weight:500;font-size:14px;color:var(--gray-700)}
        .form-input,.form-textarea,.form-select{width:100%;padding:12px 16px;background:var(--white);border:1px solid var(--gray-300);border-radius:var(--radius);font-size:15px;font-family:inherit;transition:all 0.2s}
        .form-input:focus,.form-textarea:focus,.form-select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(0,102,204,0.1)}
        .form-textarea{min-height:100px;resize:vertical}
        .form-checkbox{display:flex;align-items:center;gap:10px;cursor:pointer;font-size:14px}.form-checkbox input{width:18px;height:18px;accent-color:var(--primary)}
        
        /* File Upload Styles */
        .file-upload{border:2px dashed var(--gray-300);border-radius:var(--radius);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s;background:var(--gray-50)}
        .file-upload:hover{border-color:var(--primary);background:var(--primary-light)}
        .file-upload.dragover{border-color:var(--primary);background:var(--primary-light)}
        .file-upload-icon{font-size:32px;margin-bottom:8px}
        .file-upload-text{font-size:14px;color:var(--gray-600)}
        .file-upload-text strong{color:var(--primary)}
        .file-upload input[type="file"]{display:none}
        .file-preview{margin-top:12px;padding:12px;background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius);display:flex;align-items:center;gap:12px}
        .file-preview img{width:60px;height:60px;object-fit:cover;border-radius:var(--radius)}
        .file-preview-info{flex:1;text-align:left}
        .file-preview-name{font-weight:500;font-size:14px;color:var(--gray-800)}
        .file-preview-size{font-size:12px;color:var(--gray-500)}
        .file-preview-remove{background:none;border:none;color:var(--danger);cursor:pointer;font-size:18px}
        .upload-progress{margin-top:8px;height:4px;background:var(--gray-200);border-radius:2px;overflow:hidden}
        .upload-progress-bar{height:100%;background:var(--primary);transition:width 0.3s}
        
        /* Icon Picker */
        .icon-picker{position:relative}.icon-picker-btn{width:100%;padding:12px 16px;background:var(--white);border:1px solid var(--gray-300);border-radius:var(--radius);font-size:24px;cursor:pointer;text-align:left;display:flex;align-items:center;gap:10px}
        .icon-picker-btn span{font-size:14px;color:var(--gray-500)}
        .icon-picker-dropdown{position:absolute;top:100%;left:0;right:0;background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius);box-shadow:var(--shadow-lg);padding:12px;display:none;z-index:100;max-height:200px;overflow-y:auto}
        .icon-picker-dropdown.show{display:block}
        .icon-picker-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:8px}
        .icon-picker-item{font-size:24px;padding:8px;text-align:center;cursor:pointer;border-radius:var(--radius)}
        .icon-picker-item:hover{background:var(--gray-100)}
        
        .navbar{background:var(--white);border-bottom:1px solid var(--gray-200);position:sticky;top:0;z-index:1000}
        .nav-container{display:flex;align-items:center;justify-content:space-between;height:72px}
        .logo{display:flex;align-items:center;gap:10px;text-decoration:none;cursor:pointer}
        .logo-icon{width:40px;height:40px;background:linear-gradient(135deg,#10b981,#06b6d4);border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--white);font-weight:800;font-size:14px}
        .logo-text{font-size:22px;font-weight:800;color:var(--gray-900)}.logo-text span{color:var(--primary)}
        .nav-links{display:flex;align-items:center;gap:8px}
        .nav-link{padding:8px 16px;color:var(--gray-600);font-weight:500;font-size:15px;border-radius:var(--radius);transition:all 0.2s;cursor:pointer}
        .nav-link:hover{color:var(--primary);background:var(--primary-light)}
        .nav-actions{display:flex;align-items:center;gap:12px}
        .nav-user{display:flex;align-items:center;gap:10px;padding:6px 12px;background:var(--gray-100);border-radius:50px;cursor:pointer}
        .nav-user-avatar{width:32px;height:32px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--white);font-weight:600;font-size:13px}
        .nav-dropdown{position:relative}
        .nav-dropdown-menu{position:absolute;top:calc(100% + 8px);right:0;background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);min-width:200px;box-shadow:var(--shadow-lg);opacity:0;visibility:hidden;transform:translateY(-10px);transition:all 0.2s}
        .nav-dropdown:hover .nav-dropdown-menu{opacity:1;visibility:visible;transform:translateY(0)}
        .nav-dropdown-item{display:flex;align-items:center;gap:10px;padding:12px 16px;color:var(--gray-700);font-size:14px;cursor:pointer}
        .nav-dropdown-item:hover{background:var(--gray-50);color:var(--primary)}
        .nav-dropdown-divider{height:1px;background:var(--gray-200);margin:4px 0}
        .mobile-menu-btn{display:none;background:none;border:none;font-size:24px;cursor:pointer}
        .page{display:none}.page.active{display:block}
        .hero{background:linear-gradient(135deg,#ecfdf5 0%,#f0fdfa 50%,#eff6ff 100%);padding:80px 0}
        .hero-content{max-width:800px;margin:0 auto;text-align:center}
        .hero-badge{display:inline-flex;align-items:center;gap:8px;background:var(--white);border:1px solid var(--gray-200);padding:8px 16px;border-radius:50px;font-size:14px;font-weight:500;margin-bottom:24px;box-shadow:var(--shadow)}
        .hero-badge-dot{width:8px;height:8px;background:var(--secondary);border-radius:50%}
        .hero h1{font-size:48px;font-weight:800;color:var(--gray-900);line-height:1.15;margin-bottom:20px}
        .hero h1 span{color:var(--primary)}
        .hero-subtitle{font-size:18px;color:var(--gray-600);margin-bottom:32px}
        .hero-actions{display:flex;gap:16px;justify-content:center;flex-wrap:wrap}
        .hero-stats{display:flex;justify-content:center;gap:48px;margin-top:48px;padding-top:32px;border-top:1px solid var(--gray-200)}
        .hero-stat-value{font-size:28px;font-weight:800;color:var(--gray-900)}.hero-stat-label{font-size:14px;color:var(--gray-500)}
        .search-section{padding:32px 0;background:var(--white);border-bottom:1px solid var(--gray-200)}
        .search-box{display:flex;align-items:center;max-width:600px;margin:0 auto;background:var(--white);border:2px solid var(--gray-200);border-radius:50px;padding:6px 6px 6px 24px}
        .search-box:focus-within{border-color:var(--primary)}
        .search-box input{flex:1;border:none;outline:none;font-size:16px;background:transparent}
        .search-btn{background:var(--primary);color:var(--white);border:none;padding:12px 28px;border-radius:50px;font-weight:600;cursor:pointer}
        .search-tags{display:flex;justify-content:center;gap:10px;margin-top:16px;flex-wrap:wrap}
        .search-tag{padding:6px 14px;background:var(--gray-100);border-radius:50px;font-size:13px;color:var(--gray-600);cursor:pointer}
        .search-tag:hover{background:var(--primary-light);color:var(--primary)}
        .section{padding:64px 0}.section-gray{background:var(--gray-50)}
        .section-header{text-align:center;margin-bottom:48px}
        .section-badge{display:inline-flex;background:var(--primary-light);color:var(--primary);padding:6px 14px;border-radius:50px;font-size:13px;font-weight:600;margin-bottom:12px}
        .section-title{font-size:36px;font-weight:800;color:var(--gray-900);margin-bottom:12px}
        .section-header-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;flex-wrap:wrap;gap:16px}
        .section-header-row .section-title{margin-bottom:0;font-size:28px}
        .categories-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px}
        .category-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s}
        .category-card:hover{border-color:var(--primary);box-shadow:var(--shadow-md);transform:translateY(-2px)}
        .category-icon{font-size:36px;margin-bottom:12px}.category-name{font-weight:600;font-size:15px;margin-bottom:4px}.category-count{font-size:13px;color:var(--gray-500)}
        .templates-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:24px}
        .template-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);overflow:hidden;cursor:pointer;transition:all 0.25s}
        .template-card:hover{box-shadow:var(--shadow-lg);transform:translateY(-4px)}
        .template-preview{height:180px;background:var(--gray-100);position:relative;display:flex;align-items:center;justify-content:center}
        .template-preview img{width:100%;height:100%;object-fit:cover}
        .template-preview-placeholder{color:var(--gray-400);font-size:48px}
        .template-badge{position:absolute;top:12px;left:12px;padding:5px 10px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase}
        .template-badge.new{background:var(--secondary);color:var(--white)}
        .template-badge.popular{background:var(--orange);color:var(--white)}
        .template-badge.premium{background:var(--purple);color:var(--white)}
        .template-badge.free{background:var(--success);color:var(--white)}
        .template-info{padding:20px}
        .template-category{font-size:12px;color:var(--primary);font-weight:600;text-transform:uppercase;margin-bottom:8px}
        .template-title{font-size:16px;font-weight:600;color:var(--gray-900);margin-bottom:12px;line-height:1.4}
        .template-meta{display:flex;justify-content:space-between}
        .template-stats{display:flex;gap:12px;font-size:13px;color:var(--gray-500)}
        .template-price{font-weight:700;font-size:14px}
        .template-price.free{color:var(--success)}.template-price.paid{color:var(--gray-900)}
        .pagination{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:40px;padding-top:32px;border-top:1px solid var(--gray-200)}
        .pagination-btn{padding:10px 16px;background:var(--white);border:1px solid var(--gray-300);border-radius:var(--radius);font-size:14px;font-weight:500;cursor:pointer;font-family:inherit}
        .pagination-btn:hover:not(:disabled){background:var(--gray-50)}
        .pagination-btn:disabled{opacity:0.5;cursor:not-allowed}
        .pagination-info{padding:10px 20px;font-size:14px;color:var(--gray-600)}
        .filters{display:flex;gap:8px;flex-wrap:wrap}
        .filter-btn{padding:8px 16px;background:var(--white);border:1px solid var(--gray-300);border-radius:50px;font-size:13px;font-weight:500;cursor:pointer;font-family:inherit}
        .filter-btn:hover,.filter-btn.active{background:var(--primary);border-color:var(--primary);color:var(--white)}
        .template-detail{padding:48px 0}
        .template-detail-grid{display:grid;grid-template-columns:1fr 380px;gap:48px}
        .template-detail-image{background:var(--gray-100);border-radius:var(--radius-lg);overflow:hidden;border:1px solid var(--gray-200)}
        .template-detail-image img{width:100%;height:auto}
        .template-detail-image-placeholder{height:400px;display:flex;align-items:center;justify-content:center;color:var(--gray-400);font-size:64px}
        .template-detail-video{margin-top:24px}
        .template-detail-video iframe{width:100%;height:360px;border-radius:var(--radius-lg);border:1px solid var(--gray-200)}
        .template-detail-content h1{font-size:28px;font-weight:800;margin-bottom:16px}
        .template-detail-meta{display:flex;flex-wrap:wrap;gap:20px;margin-bottom:24px;padding-bottom:24px;border-bottom:1px solid var(--gray-200)}
        .template-detail-meta-item{display:flex;align-items:center;gap:8px;font-size:14px;color:var(--gray-600)}
        .template-detail-description{color:var(--gray-600);line-height:1.8}
        .sidebar-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:28px;position:sticky;top:96px;box-shadow:var(--shadow)}
        .sidebar-price{margin-bottom:24px;text-align:center;padding-bottom:24px;border-bottom:1px solid var(--gray-200)}
        .sidebar-price-value{font-size:36px;font-weight:800}.sidebar-price-value.free{color:var(--success)}
        .sidebar-actions{display:flex;flex-direction:column;gap:12px;margin-bottom:24px}
        .sidebar-features-title{font-weight:600;font-size:14px;margin-bottom:16px}
        .sidebar-feature{display:flex;align-items:center;gap:12px;padding:10px 0;font-size:14px;color:var(--gray-600)}
        .sidebar-feature-icon{color:var(--success)}
        .auth-page{min-height:calc(100vh - 72px);display:flex;align-items:center;justify-content:center;padding:48px 24px;background:var(--gray-50)}
        .auth-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:40px;width:100%;max-width:420px;box-shadow:var(--shadow-lg)}
        .auth-header{text-align:center;margin-bottom:32px}
        .auth-title{font-size:24px;font-weight:800;margin-bottom:8px}.auth-subtitle{color:var(--gray-500)}
        .auth-footer{text-align:center;margin-top:24px;font-size:14px;color:var(--gray-500)}
        .auth-footer a{color:var(--primary);font-weight:500;text-decoration:none}
        .admin-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}
        .admin-tabs{display:flex;gap:8px;margin-bottom:24px;border-bottom:1px solid var(--gray-200);padding-bottom:16px}
        .admin-tab{padding:10px 20px;background:transparent;border:none;font-size:14px;font-weight:500;color:var(--gray-500);cursor:pointer;border-radius:var(--radius);font-family:inherit}
        .admin-tab:hover{background:var(--gray-100)}.admin-tab.active{color:var(--primary);background:var(--primary-light)}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:32px}
        .stat-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:24px}
        .stat-card-icon{width:48px;height:48px;border-radius:var(--radius);display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:16px}
        .stat-card-icon.blue{background:var(--primary-light)}.stat-card-icon.green{background:#dcfce7}.stat-card-icon.orange{background:#fef3c7}.stat-card-icon.purple{background:#ede9fe}
        .stat-card-value{font-size:28px;font-weight:800}.stat-card-label{font-size:14px;color:var(--gray-500);margin-top:4px}
        .table-container{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);overflow:hidden}
        .table{width:100%;border-collapse:collapse}
        .table th,.table td{padding:16px 20px;text-align:left;border-bottom:1px solid var(--gray-200)}
        .table th{background:var(--gray-50);font-weight:600;font-size:13px;color:var(--gray-600);text-transform:uppercase}
        .table tr:last-child td{border-bottom:none}.table tr:hover td{background:var(--gray-50)}
        .table-actions{display:flex;gap:8px}
        .table-badge{padding:4px 10px;border-radius:50px;font-size:12px;font-weight:600}
        .table-badge.success{background:#dcfce7;color:var(--success)}.table-badge.danger{background:#fee2e2;color:var(--danger)}
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:2000;display:flex;align-items:center;justify-content:center;padding:24px;opacity:0;visibility:hidden;transition:all 0.2s}
        .modal-overlay.active{opacity:1;visibility:visible}
        .modal{background:var(--white);border-radius:var(--radius-lg);width:100%;max-width:600px;max-height:90vh;overflow-y:auto}
        .modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--gray-200)}
        .modal-title{font-size:18px;font-weight:700}
        .modal-close{background:none;border:none;font-size:24px;color:var(--gray-400);cursor:pointer}
        .modal-body{padding:24px}.modal-footer{display:flex;justify-content:flex-end;gap:12px;padding:20px 24px;border-top:1px solid var(--gray-200)}
        .toast-container{position:fixed;top:88px;right:24px;z-index:3000;display:flex;flex-direction:column;gap:12px}
        .toast{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:16px 20px;display:flex;align-items:center;gap:12px;min-width:300px;box-shadow:var(--shadow-lg);transform:translateX(120%);transition:transform 0.3s}
        .toast.show{transform:translateX(0)}.toast.success{border-left:4px solid var(--success)}.toast.error{border-left:4px solid var(--danger)}.toast.warning{border-left:4px solid var(--warning)}
        .toast-message{flex:1;font-size:14px}.toast-close{background:none;border:none;color:var(--gray-400);cursor:pointer}
        .empty-state{text-align:center;padding:64px 24px}
        .empty-state-icon{font-size:64px;margin-bottom:16px}
        .empty-state-title{font-size:20px;font-weight:700;margin-bottom:8px}
        .empty-state-text{color:var(--gray-500);margin-bottom:24px}
        .footer{background:var(--gray-900);color:var(--gray-300);padding:64px 0 32px;margin-top:64px}
        .footer-grid{display:grid;grid-template-columns:2fr repeat(3,1fr);gap:48px;margin-bottom:48px}
        .footer-brand .logo-text{color:var(--white)}
        .footer-desc{font-size:14px;line-height:1.7;margin-top:16px;color:var(--gray-400)}
        .footer-title{font-weight:600;font-size:15px;color:var(--white);margin-bottom:20px}
        .footer-links{list-style:none}.footer-links li{margin-bottom:12px}
        .footer-links a{color:var(--gray-400);text-decoration:none;font-size:14px}
        .footer-links a:hover{color:var(--white)}
        .footer-bottom{padding-top:32px;border-top:1px solid var(--gray-700);text-align:center}
        .footer-copy{font-size:14px;color:var(--gray-500)}
        .pricing-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;max-width:800px;margin:0 auto}
        .pricing-card{background:var(--white);border:2px solid var(--gray-200);border-radius:var(--radius-lg);padding:32px;text-align:center}
        .pricing-card.featured{border-color:var(--primary);position:relative}
        .pricing-card.featured::before{content:'Populaire';position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:var(--primary);color:var(--white);padding:4px 16px;border-radius:50px;font-size:12px;font-weight:600}
        .pricing-card-title{font-size:20px;font-weight:700;margin-bottom:8px}
        .pricing-card-subtitle{font-size:14px;color:var(--gray-500);margin-bottom:24px}
        .pricing-card-price{font-size:40px;font-weight:800}
        .pricing-card-price span{font-size:16px;font-weight:500;color:var(--gray-500)}
        .pricing-card-features{list-style:none;margin:24px 0;text-align:left}
        .pricing-card-features li{display:flex;align-items:center;gap:10px;padding:10px 0;font-size:14px;color:var(--gray-600)}
        .pricing-card-features li::before{content:'‚úì';color:var(--success);font-weight:700}
        .whatsapp-float{position:fixed;bottom:24px;right:24px;z-index:1000;display:flex;align-items:center;gap:12px;background:#25d366;color:var(--white);padding:14px 24px;border-radius:50px;text-decoration:none;font-weight:600;box-shadow:var(--shadow-lg)}
        .whatsapp-float:hover{transform:translateY(-3px)}
        .whatsapp-float svg{width:24px;height:24px;fill:currentColor}
        @media(max-width:1024px){.template-detail-grid{grid-template-columns:1fr}.sidebar-card{position:static}.footer-grid{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:768px){.nav-links{display:none}.mobile-menu-btn{display:block}.hero h1{font-size:32px}.hero-stats{flex-direction:column;gap:24px}.section-title{font-size:28px}.templates-grid{grid-template-columns:1fr}.footer-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>
    <a href="https://wa.me/221773684203" target="_blank" class="whatsapp-float"><svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>Besoin d'aide ?</a>
    
    <nav class="navbar"><div class="container"><div class="nav-container">
        <div class="logo" onclick="App.navigate('home')"><div class="logo-icon">XL</div><span class="logo-text">Excel<span>Model</span></span></div>
        <div class="nav-links"><span class="nav-link" onclick="App.navigate('home')">Accueil</span><span class="nav-link" onclick="App.navigate('templates')">Mod√®les</span><span class="nav-link" onclick="App.navigate('pricing')">Tarifs</span></div>
        <div class="nav-actions" id="navActions"></div>
        <button class="mobile-menu-btn" onclick="App.toggleMobileMenu()">‚ò∞</button>
    </div></div></nav>

    <main id="app">
        <div class="page active" id="page-home">
            <section class="hero"><div class="container"><div class="hero-content">
                <div class="hero-badge"><span class="hero-badge-dot"></span> +5,000 mod√®les professionnels</div>
                <h1>Mod√®les <span>Excel</span> Professionnels</h1>
                <p class="hero-subtitle">T√©l√©chargez des mod√®les Excel pr√™ts √† l'emploi. 100% √©ditables.</p>
                <div class="hero-actions"><button class="btn btn-primary btn-lg" onclick="App.navigate('templates')">Explorer les Mod√®les</button><button class="btn btn-outline btn-lg" onclick="App.navigate('pricing')">Voir les Tarifs</button></div>
                <div class="hero-stats"><div class="hero-stat"><div class="hero-stat-value" id="statTemplates">0</div><div class="hero-stat-label">Mod√®les</div></div><div class="hero-stat"><div class="hero-stat-value">50,000+</div><div class="hero-stat-label">Utilisateurs</div></div><div class="hero-stat"><div class="hero-stat-value">4.9/5</div><div class="hero-stat-label">Note moyenne</div></div></div>
            </div></div></section>
            <section class="search-section"><div class="container">
                <div class="search-box"><input type="text" id="searchInput" placeholder="Rechercher un mod√®le..." onkeyup="if(event.key==='Enter')App.search()"><button class="search-btn" onclick="App.search()">Rechercher</button></div>
                <div class="search-tags" id="searchTags"></div>
            </div></section>
            <section class="section"><div class="container">
                <div class="section-header"><div class="section-badge">üìÅ Cat√©gories</div><h2 class="section-title">Parcourir par Cat√©gorie</h2></div>
                <div class="categories-grid" id="categoriesGrid"></div>
            </div></section>
            <section class="section section-gray"><div class="container">
                <div class="section-header-row"><h2 class="section-title">Mod√®les Populaires</h2><button class="btn btn-outline" onclick="App.navigate('templates')">Voir tout ‚Üí</button></div>
                <div class="templates-grid" id="featuredTemplatesGrid"></div>
            </div></section>
        </div>

        <div class="page" id="page-templates"><section class="section"><div class="container">
            <div class="section-header-row"><h2 class="section-title">Tous les Mod√®les</h2><div class="filters" id="templatesFilters"></div></div>
            <div class="templates-grid" id="allTemplatesGrid"></div>
            <div class="pagination" id="pagination"></div>
        </div></section></div>

        <div class="page" id="page-template-detail"><section class="template-detail"><div class="container" id="templateDetail"></div></section></div>

        <div class="page" id="page-login"><div class="auth-page"><div class="auth-card">
            <div class="auth-header"><h1 class="auth-title">Connexion</h1><p class="auth-subtitle">Acc√©dez √† votre compte</p></div>
            <form onsubmit="App.login(event)"><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="loginEmail" required></div><div class="form-group"><label class="form-label">Mot de passe</label><input type="password" class="form-input" id="loginPassword" required></div><button type="submit" class="btn btn-primary btn-block btn-lg">Se connecter</button></form>
            <div class="auth-footer">Pas encore de compte ? <a href="#" onclick="App.navigate('register');return false">S'inscrire</a></div>
        </div></div></div>

        <div class="page" id="page-register"><div class="auth-page"><div class="auth-card">
            <div class="auth-header"><h1 class="auth-title">Cr√©er un compte</h1></div>
            <form onsubmit="App.register(event)"><div class="form-group"><label class="form-label">Nom complet</label><input type="text" class="form-input" id="registerName" required></div><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="registerEmail" required></div><div class="form-group"><label class="form-label">Mot de passe</label><input type="password" class="form-input" id="registerPassword" required minlength="6"></div><button type="submit" class="btn btn-primary btn-block btn-lg">Cr√©er mon compte</button></form>
            <div class="auth-footer">D√©j√† un compte ? <a href="#" onclick="App.navigate('login');return false">Se connecter</a></div>
        </div></div></div>

        <div class="page" id="page-admin"><section class="section"><div class="container">
            <div class="admin-header"><h2 class="section-title">Administration</h2><button class="btn btn-primary" onclick="App.openTemplateModal()">+ Nouveau Mod√®le</button></div>
            <div class="stats-grid" id="adminStats"></div>
            <div class="admin-tabs" id="adminTabs"><button class="admin-tab active" data-tab="templates">üìÑ Mod√®les</button><button class="admin-tab" data-tab="categories">üìÅ Cat√©gories</button></div>
            <div id="adminContent"></div>
        </div></section></div>

        <div class="page" id="page-pricing"><section class="section"><div class="container">
            <div class="section-header"><h2 class="section-title">Choisissez Votre Formule</h2></div>
            <div class="pricing-grid">
                <div class="pricing-card"><div class="pricing-card-title">Mensuel</div><div class="pricing-card-price">9,900 <span>FCFA</span></div><ul class="pricing-card-features"><li>Acc√®s √† tous les mod√®les</li><li>T√©l√©chargements illimit√©s</li></ul><button class="btn btn-outline btn-block btn-lg">Choisir</button></div>
                <div class="pricing-card featured"><div class="pricing-card-title">Annuel</div><div class="pricing-card-price">59,000 <span>FCFA</span></div><ul class="pricing-card-features"><li>Tout du plan mensuel</li><li>Support WhatsApp prioritaire</li></ul><button class="btn btn-primary btn-block btn-lg">Choisir</button></div>
            </div>
        </div></section></div>
    </main>

    <footer class="footer"><div class="container">
        <div class="footer-grid">
            <div class="footer-brand"><div class="logo"><div class="logo-icon">XL</div><span class="logo-text">Excel<span>Model</span></span></div><p class="footer-desc">Mod√®les Excel professionnels pour les entreprises africaines.</p></div>
            <div><h4 class="footer-title">Liens</h4><ul class="footer-links"><li><a href="#" onclick="App.navigate('templates')">Mod√®les</a></li><li><a href="#" onclick="App.navigate('pricing')">Tarifs</a></li></ul></div>
            <div><h4 class="footer-title">Contact</h4><ul class="footer-links"><li><a href="https://wa.me/221773684203">WhatsApp</a></li><li><a href="/cdn-cgi/l/email-protection#196a786e787d7e6a7875707f597e74787075377a7674">Email</a></li></ul></div>
        </div>
        <div class="footer-bottom"><p class="footer-copy">¬© 2026 ExcelModel | <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="98ebf9eff9fcffebf9f4f1fed8fff5f9f1f4b6fbf7f5">[email&#160;protected]</a> | +221 77 368 42 03</p></div>
    </div></footer>

    <!-- TEMPLATE MODAL WITH FILE UPLOAD -->
    <div class="modal-overlay" id="templateModal"><div class="modal">
        <div class="modal-header"><h2 class="modal-title" id="templateModalTitle">Nouveau Mod√®le</h2><button class="modal-close" onclick="App.closeModal('templateModal')">√ó</button></div>
        <div class="modal-body"><form id="templateForm" onsubmit="App.saveTemplate(event)">
            <input type="hidden" id="templateId">
            <div class="form-group"><label class="form-label">Titre *</label><input type="text" class="form-input" id="templateTitle" required></div>
            <div class="form-group"><label class="form-label">Cat√©gorie *</label><select class="form-select" id="templateCategoryId" required></select></div>
            <div class="form-group"><label class="form-label">Description courte</label><input type="text" class="form-input" id="templateShortDesc"></div>
            <div class="form-group"><label class="form-label">Description compl√®te</label><textarea class="form-textarea" id="templateDescription"></textarea></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
                <div class="form-group"><label class="form-label">Prix (FCFA)</label><input type="number" class="form-input" id="templatePrice" value="0" min="0"></div>
                <div class="form-group"><label class="form-label">Badge</label><select class="form-select" id="templateBadge"><option value="">Aucun</option><option value="new">Nouveau</option><option value="popular">Populaire</option><option value="premium">Premium</option></select></div>
            </div>
            
            <!-- IMAGE UPLOAD -->
            <div class="form-group">
                <label class="form-label">Image d'aper√ßu</label>
                <div class="file-upload" id="imageUploadZone" onclick="document.getElementById('imageFile').click()">
                    <input type="file" id="imageFile" accept="image/*" onchange="App.handleImageSelect(event)">
                    <div class="file-upload-icon">üñºÔ∏è</div>
                    <div class="file-upload-text"><strong>Cliquez</strong> ou glissez une image ici</div>
                </div>
                <div id="imagePreview" style="display:none"></div>
                <input type="hidden" id="templateImageUrl">
            </div>
            
            <!-- FILE UPLOAD -->
            <div class="form-group">
                <label class="form-label">Fichier Excel</label>
                <div class="file-upload" id="fileUploadZone" onclick="document.getElementById('excelFile').click()">
                    <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" onchange="App.handleFileSelect(event)">
                    <div class="file-upload-icon">üìÑ</div>
                    <div class="file-upload-text"><strong>Cliquez</strong> ou glissez un fichier Excel ici</div>
                </div>
                <div id="filePreview" style="display:none"></div>
                <input type="hidden" id="templateFileUrl">
            </div>
            
            <div class="form-group"><label class="form-label">URL Vid√©o YouTube (optionnel)</label><input type="url" class="form-input" id="templateVideoUrl" placeholder="https://youtube.com/watch?v=..."></div>
            <div class="form-group"><label class="form-label">Mots-cl√©s (s√©par√©s par virgule)</label><input type="text" class="form-input" id="templateKeywords"></div>
            <div style="display:flex;gap:20px"><label class="form-checkbox"><input type="checkbox" id="templateIsFree"> Gratuit</label><label class="form-checkbox"><input type="checkbox" id="templateIsFeatured"> Mis en avant</label><label class="form-checkbox"><input type="checkbox" id="templateIsActive" checked> Actif</label></div>
        </form></div>
        <div class="modal-footer"><button class="btn btn-outline" onclick="App.closeModal('templateModal')">Annuler</button><button class="btn btn-primary" id="saveTemplateBtn" onclick="document.getElementById('templateForm').requestSubmit()">Enregistrer</button></div>
    </div></div>

    <!-- CATEGORY MODAL -->
    <div class="modal-overlay" id="categoryModal"><div class="modal">
        <div class="modal-header"><h2 class="modal-title" id="categoryModalTitle">Nouvelle Cat√©gorie</h2><button class="modal-close" onclick="App.closeModal('categoryModal')">√ó</button></div>
        <div class="modal-body"><form id="categoryForm" onsubmit="App.saveCategory(event)">
            <input type="hidden" id="categoryId">
            <div class="form-group"><label class="form-label">Nom *</label><input type="text" class="form-input" id="categoryName" required></div>
            <div class="form-group"><label class="form-label">Ic√¥ne</label>
                <div class="icon-picker"><button type="button" class="icon-picker-btn" onclick="App.toggleIconPicker()"><span id="selectedIcon">üìÅ</span> <span>Cliquer pour choisir</span></button><div class="icon-picker-dropdown" id="iconPickerDropdown"><div class="icon-picker-grid" id="iconPickerGrid"></div></div></div>
                <input type="hidden" id="categoryIcon" value="üìÅ">
            </div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="categoryDescription"></textarea></div>
            <div class="form-group"><label class="form-label">Ordre</label><input type="number" class="form-input" id="categoryOrder" value="0"></div>
        </form></div>
        <div class="modal-footer"><button class="btn btn-outline" onclick="App.closeModal('categoryModal')">Annuler</button><button class="btn btn-primary" onclick="document.getElementById('categoryForm').requestSubmit()">Enregistrer</button></div>
    </div></div>

    <div class="modal-overlay" id="confirmModal"><div class="modal" style="max-width:400px">
        <div class="modal-header"><h2 class="modal-title">Confirmation</h2><button class="modal-close" onclick="App.closeModal('confirmModal')">√ó</button></div>
        <div class="modal-body"><p id="confirmMessage">√ätes-vous s√ªr ?</p></div>
        <div class="modal-footer"><button class="btn btn-outline" onclick="App.closeModal('confirmModal')">Annuler</button><button class="btn btn-danger" id="confirmBtn">Supprimer</button></div>
    </div></div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
const SUPABASE_URL = 'https://nnkkeetruqonyjykuxre.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ua2tlZXRydXFvbnlqeWt1eHJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMTQyMDAsImV4cCI6MjA4Mzg5MDIwMH0.y24yrgbRkg5PjU_HQ6O3nZxXOpv9yN5OLCYAuwu1gAo';
const ADMIN_EMAIL = 'sawadgsalif@gmail.com';
const ITEMS_PER_PAGE = 9;
const ICONS = ['üìä','üí∞','üìÖ','üë•','üì¶','üßæ','üìà','üìâ','üíµ','üí≥','üè¶','üìã','üìù','‚úÖ','‚ö°','üéØ','üîß','‚öôÔ∏è','üìÅ','üóÇÔ∏è','üíº','üè¢','üõí','üõçÔ∏è','üì±','üíª'];

const App = {
    supabase: null, user: null, profile: null, categories: [], templates: [], filteredTemplates: [], 
    currentPage: 1, currentTab: 'templates', currentFilter: 'all',
    uploadingImage: false, uploadingFile: false,
    selectedImageFile: null, selectedExcelFile: null,

    async init() {
        this.supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const { data: { session } } = await this.supabase.auth.getSession();
        if (session) { this.user = session.user; await this.loadProfile(); }
        this.supabase.auth.onAuthStateChange(async (e, s) => {
            if (e === 'SIGNED_IN' && s) { this.user = s.user; await this.loadProfile(); }
            else if (e === 'SIGNED_OUT') { this.user = null; this.profile = null; }
            this.updateNav();
        });
        await this.loadCategories();
        await this.loadTemplates();
        this.filteredTemplates = [...this.templates];
        this.updateNav(); this.renderAll(); this.handleRoute(); this.setupEvents();
        document.getElementById('statTemplates').textContent = this.templates.length;
    },

    setupEvents() {
        window.addEventListener('popstate', () => this.handleRoute());
        document.getElementById('adminTabs')?.addEventListener('click', e => {
            if (e.target.classList.contains('admin-tab')) {
                document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                this.currentTab = e.target.dataset.tab;
                this.renderAdminContent();
            }
        });
        document.addEventListener('click', e => { if (!e.target.closest('.icon-picker')) document.getElementById('iconPickerDropdown')?.classList.remove('show'); });
        this.setupDragDrop('imageUploadZone', 'imageFile');
        this.setupDragDrop('fileUploadZone', 'excelFile');
    },

    setupDragDrop(zoneId, inputId) {
        const zone = document.getElementById(zoneId);
        if (!zone) return;
        ['dragenter','dragover'].forEach(e => zone.addEventListener(e, ev => { ev.preventDefault(); zone.classList.add('dragover'); }));
        ['dragleave','drop'].forEach(e => zone.addEventListener(e, ev => { ev.preventDefault(); zone.classList.remove('dragover'); }));
        zone.addEventListener('drop', e => {
            const file = e.dataTransfer.files[0];
            if (file) {
                if (inputId === 'imageFile') this.handleImageFile(file);
                else this.handleExcelFile(file);
            }
        });
    },

    async loadProfile() {
        if (!this.user) return;
        const { data } = await this.supabase.from('profiles').select('*').eq('id', this.user.id).maybeSingle();
        this.profile = data;
    },

    async loadCategories() {
        const { data } = await this.supabase.from('categories').select('*').eq('is_active', true).order('display_order');
        this.categories = data || [];
    },

    async loadTemplates() {
        const { data } = await this.supabase.from('templates').select('*, categories(name, icon)').eq('is_active', true).order('created_at', { ascending: false });
        this.templates = (data || []).map(t => ({ ...t, category_name: t.categories?.name, category_icon: t.categories?.icon }));
    },

    renderAll() {
        this.renderCategories(); this.renderFeaturedTemplates(); this.renderSearchTags(); this.renderIconPicker();
    },

    navigate(page, params = {}) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + page)?.classList.add('active');
        const url = new URL(window.location);
        url.searchParams.set('page', page);
        Object.entries(params).forEach(([k, v]) => v ? url.searchParams.set(k, v) : url.searchParams.delete(k));
        window.history.pushState({}, '', url);
        this.onPageChange(page, params);
        window.scrollTo(0, 0);
    },

    handleRoute() {
        const url = new URL(window.location);
        const page = url.searchParams.get('page') || 'home';
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + page)?.classList.add('active');
        this.onPageChange(page, { slug: url.searchParams.get('slug') });
    },

    onPageChange(page, params) {
        if (page === 'templates') { this.currentPage = 1; this.currentFilter = 'all'; this.filteredTemplates = [...this.templates]; this.renderAllTemplates(); }
        else if (page === 'template-detail') this.renderTemplateDetail(params.slug);
        else if (page === 'admin') { if (this.isAdmin()) this.renderAdmin(); else this.navigate('home'); }
    },

    updateNav() {
        const nav = document.getElementById('navActions');
        if (this.user) {
            const initials = (this.profile?.full_name || this.user.email).split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
            nav.innerHTML = `<div class="nav-dropdown"><div class="nav-user"><div class="nav-user-avatar">${initials}</div></div><div class="nav-dropdown-menu">${this.isAdmin() ? '<div class="nav-dropdown-item" onclick="App.navigate(\'admin\')">‚öôÔ∏è Administration</div><div class="nav-dropdown-divider"></div>' : ''}<div class="nav-dropdown-item" onclick="App.logout()">üö™ D√©connexion</div></div></div>`;
        } else {
            nav.innerHTML = '<button class="btn btn-ghost" onclick="App.navigate(\'login\')">Connexion</button><button class="btn btn-primary" onclick="App.navigate(\'register\')">S\'inscrire</button>';
        }
    },

    renderCategories() {
        const grid = document.getElementById('categoriesGrid');
        if (!grid) return;
        grid.innerHTML = this.categories.length ? this.categories.map(c => `<div class="category-card" onclick="App.filterByCategory('${c.id}')"><div class="category-icon">${c.icon || 'üìÅ'}</div><div class="category-name">${c.name}</div><div class="category-count">${this.templates.filter(t => t.category_id === c.id).length} mod√®les</div></div>`).join('') : '<p style="text-align:center;color:var(--gray-500);grid-column:1/-1">Aucune cat√©gorie</p>';
    },

    renderSearchTags() {
        const tags = document.getElementById('searchTags');
        if (tags) tags.innerHTML = ['Dashboard','Budget','Paie','Gantt','Stock','Factures'].map(t => `<span class="search-tag" onclick="App.searchTag('${t}')">${t}</span>`).join('');
    },

    renderFeaturedTemplates() {
        const grid = document.getElementById('featuredTemplatesGrid');
        if (!grid) return;
        const list = this.templates.filter(t => t.is_featured || t.badge).slice(0, 6);
        grid.innerHTML = (list.length ? list : this.templates.slice(0, 6)).map(t => this.templateCard(t)).join('') || '<p style="text-align:center;color:var(--gray-500);grid-column:1/-1">Aucun mod√®le</p>';
    },

    renderAllTemplates() {
        const grid = document.getElementById('allTemplatesGrid');
        const filters = document.getElementById('templatesFilters');
        const pagination = document.getElementById('pagination');
        if (!grid) return;
        const totalPages = Math.ceil(this.filteredTemplates.length / ITEMS_PER_PAGE);
        const start = (this.currentPage - 1) * ITEMS_PER_PAGE;
        const items = this.filteredTemplates.slice(start, start + ITEMS_PER_PAGE);
        grid.innerHTML = items.length ? items.map(t => this.templateCard(t)).join('') : '<div class="empty-state" style="grid-column:1/-1"><div class="empty-state-icon">üîç</div><h3 class="empty-state-title">Aucun mod√®le trouv√©</h3></div>';
        if (filters) filters.innerHTML = `<button class="filter-btn ${this.currentFilter === 'all' ? 'active' : ''}" onclick="App.filter('all')">Tous</button>` + this.categories.map(c => `<button class="filter-btn ${this.currentFilter === c.id ? 'active' : ''}" onclick="App.filter('${c.id}')">${c.name}</button>`).join('');
        if (pagination) pagination.innerHTML = totalPages > 1 ? `<button class="pagination-btn" onclick="App.goToPage(${this.currentPage - 1})" ${this.currentPage === 1 ? 'disabled' : ''}>‚Üê Pr√©c√©dent</button><span class="pagination-info">Page ${this.currentPage} / ${totalPages}</span><button class="pagination-btn" onclick="App.goToPage(${this.currentPage + 1})" ${this.currentPage === totalPages ? 'disabled' : ''}>Suivant ‚Üí</button>` : '';
    },

    templateCard(t) {
        const badge = t.badge === 'popular' ? 'Populaire' : t.badge === 'new' ? 'Nouveau' : t.badge === 'premium' ? 'Premium' : t.is_free ? 'Gratuit' : '';
        return `<div class="template-card" onclick="App.navigate('template-detail', { slug: '${t.slug}' })"><div class="template-preview">${badge ? `<span class="template-badge ${t.badge || 'free'}">${badge}</span>` : ''}${t.preview_image_url ? `<img src="${t.preview_image_url}" alt="">` : '<div class="template-preview-placeholder">üìÑ</div>'}</div><div class="template-info"><div class="template-category">${t.category_name || ''}</div><h3 class="template-title">${t.title}</h3><div class="template-meta"><div class="template-stats"><span>‚¨á ${t.downloads_count || 0}</span></div><span class="template-price ${t.is_free ? 'free' : 'paid'}">${t.is_free ? 'Gratuit' : this.formatPrice(t.price)}</span></div></div></div>`;
    },

    renderTemplateDetail(slug) {
        const c = document.getElementById('templateDetail');
        const t = this.templates.find(x => x.slug === slug);
        if (!t) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîç</div><h3>Mod√®le non trouv√©</h3></div>'; return; }
        const video = t.video_url?.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
        c.innerHTML = `<div class="template-detail-grid"><div><div class="template-detail-image">${t.preview_image_url ? `<img src="${t.preview_image_url}">` : '<div class="template-detail-image-placeholder">üìÑ</div>'}</div>${video ? `<div class="template-detail-video"><iframe src="https://www.youtube.com/embed/${video[1]}" allowfullscreen></iframe></div>` : ''}<div class="template-detail-content" style="margin-top:32px"><h1>${t.title}</h1><div class="template-detail-meta"><span class="template-detail-meta-item">üìÅ ${t.category_name || ''}</span><span class="template-detail-meta-item">‚¨á ${t.downloads_count || 0}</span></div><div class="template-detail-description">${t.description || t.short_description || ''}</div></div></div><div><div class="sidebar-card"><div class="sidebar-price"><div class="sidebar-price-value ${t.is_free ? 'free' : ''}">${t.is_free ? 'Gratuit' : this.formatPrice(t.price)}</div></div><div class="sidebar-actions">${t.is_free || t.file_url ? `<button class="btn btn-primary btn-block btn-lg" onclick="App.download('${t.id}')">‚¨á T√©l√©charger</button>` : `<button class="btn btn-primary btn-block btn-lg">üí≥ Acheter</button>`}<a href="https://wa.me/221773684203?text=${encodeURIComponent('Question sur: ' + t.title)}" target="_blank" class="btn btn-success btn-block">üí¨ WhatsApp</a></div></div></div></div>`;
    },

    isAdmin() { return this.user?.email === ADMIN_EMAIL || this.profile?.role === 'admin'; },

    renderAdmin() {
        document.getElementById('adminStats').innerHTML = `<div class="stat-card"><div class="stat-card-icon blue">üìÑ</div><div class="stat-card-value">${this.templates.length}</div><div class="stat-card-label">Mod√®les</div></div><div class="stat-card"><div class="stat-card-icon green">üìÅ</div><div class="stat-card-value">${this.categories.length}</div><div class="stat-card-label">Cat√©gories</div></div>`;
        this.renderAdminContent();
    },

    renderAdminContent() {
        const c = document.getElementById('adminContent');
        if (this.currentTab === 'templates') {
            c.innerHTML = `<div class="table-container"><table class="table"><thead><tr><th>Titre</th><th>Cat√©gorie</th><th>Prix</th><th>Actions</th></tr></thead><tbody>${this.templates.length ? this.templates.map(t => `<tr><td><strong>${t.title}</strong></td><td>${t.category_name || '-'}</td><td>${t.is_free ? '<span class="table-badge success">Gratuit</span>' : this.formatPrice(t.price)}</td><td><div class="table-actions"><button class="btn btn-sm btn-ghost" onclick="App.editTemplate('${t.id}')">‚úèÔ∏è</button><button class="btn btn-sm btn-ghost" onclick="App.confirmDelete('template','${t.id}')">üóëÔ∏è</button></div></td></tr>`).join('') : '<tr><td colspan="4" style="text-align:center">Aucun mod√®le</td></tr>'}</tbody></table></div>`;
        } else {
            c.innerHTML = `<div style="margin-bottom:16px"><button class="btn btn-primary" onclick="App.openCategoryModal()">+ Nouvelle Cat√©gorie</button></div><div class="table-container"><table class="table"><thead><tr><th>Ic√¥ne</th><th>Nom</th><th>Actions</th></tr></thead><tbody>${this.categories.length ? this.categories.map(cat => `<tr><td style="font-size:28px">${cat.icon || 'üìÅ'}</td><td><strong>${cat.name}</strong></td><td><div class="table-actions"><button class="btn btn-sm btn-ghost" onclick="App.editCategory('${cat.id}')">‚úèÔ∏è</button><button class="btn btn-sm btn-ghost" onclick="App.confirmDelete('category','${cat.id}')">üóëÔ∏è</button></div></td></tr>`).join('') : '<tr><td colspan="3" style="text-align:center">Aucune cat√©gorie</td></tr>'}</tbody></table></div>`;
        }
    },

    // ========== FILE UPLOAD ==========
    handleImageSelect(e) { if (e.target.files[0]) this.handleImageFile(e.target.files[0]); },
    handleFileSelect(e) { if (e.target.files[0]) this.handleExcelFile(e.target.files[0]); },

    handleImageFile(file) {
        if (!file.type.startsWith('image/')) { this.toast('Veuillez s√©lectionner une image', 'error'); return; }
        this.selectedImageFile = file;
        const reader = new FileReader();
        reader.onload = e => {
            document.getElementById('imagePreview').innerHTML = `<div class="file-preview"><img src="${e.target.result}"><div class="file-preview-info"><div class="file-preview-name">${file.name}</div><div class="file-preview-size">${(file.size / 1024).toFixed(1)} Ko</div></div><button type="button" class="file-preview-remove" onclick="App.removeImage()">√ó</button></div>`;
            document.getElementById('imagePreview').style.display = 'block';
            document.getElementById('imageUploadZone').style.display = 'none';
        };
        reader.readAsDataURL(file);
    },

    handleExcelFile(file) {
        const validTypes = ['application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'text/csv'];
        const ext = file.name.split('.').pop().toLowerCase();
        if (!validTypes.includes(file.type) && !['xlsx', 'xls', 'csv'].includes(ext)) { this.toast('Veuillez s√©lectionner un fichier Excel', 'error'); return; }
        this.selectedExcelFile = file;
        document.getElementById('filePreview').innerHTML = `<div class="file-preview"><div style="font-size:32px">üìÑ</div><div class="file-preview-info"><div class="file-preview-name">${file.name}</div><div class="file-preview-size">${(file.size / 1024).toFixed(1)} Ko</div></div><button type="button" class="file-preview-remove" onclick="App.removeFile()">√ó</button></div>`;
        document.getElementById('filePreview').style.display = 'block';
        document.getElementById('fileUploadZone').style.display = 'none';
    },

    removeImage() {
        this.selectedImageFile = null;
        document.getElementById('imagePreview').style.display = 'none';
        document.getElementById('imageUploadZone').style.display = 'block';
        document.getElementById('imageFile').value = '';
        document.getElementById('templateImageUrl').value = '';
    },

    removeFile() {
        this.selectedExcelFile = null;
        document.getElementById('filePreview').style.display = 'none';
        document.getElementById('fileUploadZone').style.display = 'block';
        document.getElementById('excelFile').value = '';
        document.getElementById('templateFileUrl').value = '';
    },

    async uploadFile(file, bucket) {
        const ext = file.name.split('.').pop();
        const fileName = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}.${ext}`;
        const { data, error } = await this.supabase.storage.from(bucket).upload(fileName, file);
        if (error) throw error;
        const { data: urlData } = this.supabase.storage.from(bucket).getPublicUrl(fileName);
        return urlData.publicUrl;
    },

    // ========== MODALS ==========
    renderIconPicker() {
        const grid = document.getElementById('iconPickerGrid');
        if (grid) grid.innerHTML = ICONS.map(i => `<div class="icon-picker-item" onclick="App.selectIcon('${i}')">${i}</div>`).join('');
    },
    toggleIconPicker() { document.getElementById('iconPickerDropdown').classList.toggle('show'); },
    selectIcon(icon) { document.getElementById('selectedIcon').textContent = icon; document.getElementById('categoryIcon').value = icon; document.getElementById('iconPickerDropdown').classList.remove('show'); },

    openTemplateModal(t = null) {
        document.getElementById('templateModalTitle').textContent = t ? 'Modifier le Mod√®le' : 'Nouveau Mod√®le';
        document.getElementById('templateId').value = t?.id || '';
        document.getElementById('templateTitle').value = t?.title || '';
        document.getElementById('templateShortDesc').value = t?.short_description || '';
        document.getElementById('templateDescription').value = t?.description || '';
        document.getElementById('templatePrice').value = t?.price || 0;
        document.getElementById('templateBadge').value = t?.badge || '';
        document.getElementById('templateVideoUrl').value = t?.video_url || '';
        document.getElementById('templateKeywords').value = t?.keywords?.join(', ') || '';
        document.getElementById('templateIsFree').checked = t?.is_free || false;
        document.getElementById('templateIsFeatured').checked = t?.is_featured || false;
        document.getElementById('templateIsActive').checked = t?.is_active !== false;
        document.getElementById('templateImageUrl').value = t?.preview_image_url || '';
        document.getElementById('templateFileUrl').value = t?.file_url || '';
        document.getElementById('templateCategoryId').innerHTML = this.categories.map(c => `<option value="${c.id}" ${t?.category_id === c.id ? 'selected' : ''}>${c.icon || 'üìÅ'} ${c.name}</option>`).join('');
        
        // Reset file uploads
        this.selectedImageFile = null; this.selectedExcelFile = null;
        document.getElementById('imagePreview').style.display = 'none';
        document.getElementById('filePreview').style.display = 'none';
        document.getElementById('imageUploadZone').style.display = 'block';
        document.getElementById('fileUploadZone').style.display = 'block';
        
        // Show existing files
        if (t?.preview_image_url) {
            document.getElementById('imagePreview').innerHTML = `<div class="file-preview"><img src="${t.preview_image_url}"><div class="file-preview-info"><div class="file-preview-name">Image existante</div></div><button type="button" class="file-preview-remove" onclick="App.removeImage()">√ó</button></div>`;
            document.getElementById('imagePreview').style.display = 'block';
            document.getElementById('imageUploadZone').style.display = 'none';
        }
        if (t?.file_url) {
            document.getElementById('filePreview').innerHTML = `<div class="file-preview"><div style="font-size:32px">üìÑ</div><div class="file-preview-info"><div class="file-preview-name">Fichier existant</div></div><button type="button" class="file-preview-remove" onclick="App.removeFile()">√ó</button></div>`;
            document.getElementById('filePreview').style.display = 'block';
            document.getElementById('fileUploadZone').style.display = 'none';
        }
        
        document.getElementById('templateModal').classList.add('active');
    },

    openCategoryModal(c = null) {
        document.getElementById('categoryModalTitle').textContent = c ? 'Modifier' : 'Nouvelle Cat√©gorie';
        document.getElementById('categoryId').value = c?.id || '';
        document.getElementById('categoryName').value = c?.name || '';
        document.getElementById('categoryIcon').value = c?.icon || 'üìÅ';
        document.getElementById('selectedIcon').textContent = c?.icon || 'üìÅ';
        document.getElementById('categoryDescription').value = c?.description || '';
        document.getElementById('categoryOrder').value = c?.display_order || 0;
        document.getElementById('categoryModal').classList.add('active');
    },

    closeModal(id) { document.getElementById(id).classList.remove('active'); },

    confirmDelete(type, id) {
        document.getElementById('confirmMessage').textContent = `Supprimer ${type === 'template' ? 'ce mod√®le' : 'cette cat√©gorie'} ?`;
        document.getElementById('confirmBtn').onclick = () => { type === 'template' ? this.deleteTemplate(id) : this.deleteCategory(id); this.closeModal('confirmModal'); };
        document.getElementById('confirmModal').classList.add('active');
    },

    // ========== CRUD ==========
    async saveTemplate(e) {
        e.preventDefault();
        const btn = document.getElementById('saveTemplateBtn');
        btn.disabled = true; btn.textContent = 'Enregistrement...';
        
        try {
            let imageUrl = document.getElementById('templateImageUrl').value;
            let fileUrl = document.getElementById('templateFileUrl').value;
            
            // Upload new image
            if (this.selectedImageFile) {
                this.toast('Upload de l\'image...', 'warning');
                imageUrl = await this.uploadFile(this.selectedImageFile, 'images');
            }
            
            // Upload new file
            if (this.selectedExcelFile) {
                this.toast('Upload du fichier...', 'warning');
                fileUrl = await this.uploadFile(this.selectedExcelFile, 'templates');
            }
            
            const id = document.getElementById('templateId').value;
            const title = document.getElementById('templateTitle').value;
            const data = {
                title: title,
                category_id: document.getElementById('templateCategoryId').value,
                short_description: document.getElementById('templateShortDesc').value || null,
                description: document.getElementById('templateDescription').value || null,
                price: parseFloat(document.getElementById('templatePrice').value) || 0,
                badge: document.getElementById('templateBadge').value || null,
                preview_image_url: imageUrl || null,
                file_url: fileUrl || null,
                video_url: document.getElementById('templateVideoUrl').value || null,
                keywords: document.getElementById('templateKeywords').value ? document.getElementById('templateKeywords').value.split(',').map(k => k.trim()).filter(k => k) : [],
                is_free: document.getElementById('templateIsFree').checked,
                is_featured: document.getElementById('templateIsFeatured').checked,
                is_active: document.getElementById('templateIsActive').checked
            };
            
            // Ajouter le slug seulement pour les nouveaux mod√®les
            if (!id) {
                data.slug = title.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
            }
            
            const { error } = id ? await this.supabase.from('templates').update(data).eq('id', id) : await this.supabase.from('templates').insert(data);
            if (error) throw error;
            
            await this.loadTemplates();
            this.filteredTemplates = [...this.templates];
            this.closeModal('templateModal');
            this.renderAdmin();
            this.renderFeaturedTemplates();
            document.getElementById('statTemplates').textContent = this.templates.length;
            this.toast('Mod√®le enregistr√© !', 'success');
        } catch (err) {
            console.error(err);
            this.toast('Erreur: ' + err.message, 'error');
        }
        btn.disabled = false; btn.textContent = 'Enregistrer';
    },

    async saveCategory(e) {
        e.preventDefault();
        const id = document.getElementById('categoryId').value;
        const name = document.getElementById('categoryName').value;
        const data = {
            name: name,
            icon: document.getElementById('categoryIcon').value || 'üìÅ',
            description: document.getElementById('categoryDescription').value || null,
            display_order: parseInt(document.getElementById('categoryOrder').value) || 0,
            is_active: true
        };
        // Ajouter le slug seulement pour les nouvelles cat√©gories
        if (!id) {
            data.slug = name.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/[^a-z0-9]+/g, '-');
        }
        try {
            const { error } = id ? await this.supabase.from('categories').update(data).eq('id', id) : await this.supabase.from('categories').insert(data);
            if (error) throw error;
            await this.loadCategories();
            this.closeModal('categoryModal');
            this.renderCategories(); this.renderAdmin();
            this.toast('Cat√©gorie enregistr√©e !', 'success');
        } catch (err) { this.toast('Erreur: ' + err.message, 'error'); }
    },

    editTemplate(id) { this.openTemplateModal(this.templates.find(t => t.id === id)); },
    editCategory(id) { this.openCategoryModal(this.categories.find(c => c.id === id)); },

    async deleteTemplate(id) {
        const { error } = await this.supabase.from('templates').delete().eq('id', id);
        if (!error) { await this.loadTemplates(); this.filteredTemplates = [...this.templates]; this.renderAdmin(); this.renderFeaturedTemplates(); this.toast('Supprim√©', 'success'); }
    },

    async deleteCategory(id) {
        const { error } = await this.supabase.from('categories').delete().eq('id', id);
        if (!error) { await this.loadCategories(); this.renderCategories(); this.renderAdmin(); this.toast('Supprim√©', 'success'); }
    },

    // ========== AUTH ==========
    async login(e) {
        e.preventDefault();
        const { error } = await this.supabase.auth.signInWithPassword({ email: document.getElementById('loginEmail').value, password: document.getElementById('loginPassword').value });
        if (error) { this.toast(error.message, 'error'); return; }
        this.toast('Connect√© !', 'success'); this.navigate('home');
    },

    async register(e) {
        e.preventDefault();
        const { error } = await this.supabase.auth.signUp({ email: document.getElementById('registerEmail').value, password: document.getElementById('registerPassword').value, options: { data: { full_name: document.getElementById('registerName').value } } });
        if (error) { this.toast(error.message, 'error'); return; }
        this.toast('Compte cr√©√© !', 'success'); this.navigate('home');
    },

    async logout() { await this.supabase.auth.signOut(); this.navigate('home'); this.toast('D√©connect√©', 'success'); },

    // ========== UTILS ==========
    search() { const q = document.getElementById('searchInput').value.toLowerCase(); if (q) { this.navigate('templates'); setTimeout(() => { this.filteredTemplates = this.templates.filter(t => t.title.toLowerCase().includes(q)); this.renderAllTemplates(); }, 100); } },
    searchTag(t) { document.getElementById('searchInput').value = t; this.search(); },
    filter(id) { this.currentFilter = id; this.currentPage = 1; this.filteredTemplates = id === 'all' ? [...this.templates] : this.templates.filter(t => t.category_id === id); this.renderAllTemplates(); },
    filterByCategory(id) { this.navigate('templates'); setTimeout(() => this.filter(id), 100); },
    goToPage(p) { const max = Math.ceil(this.filteredTemplates.length / ITEMS_PER_PAGE); if (p >= 1 && p <= max) { this.currentPage = p; this.renderAllTemplates(); window.scrollTo({ top: 200, behavior: 'smooth' }); } },
    download(id) { const t = this.templates.find(x => x.id === id); if (t?.file_url) window.open(t.file_url, '_blank'); else this.toast('Fichier non disponible', 'error'); },
    formatPrice(p) { return new Intl.NumberFormat('fr-FR').format(p || 0) + ' FCFA'; },
    toast(msg, type = 'success') { const c = document.getElementById('toastContainer'); const t = document.createElement('div'); t.className = 'toast ' + type; t.innerHTML = `<span>${type === 'success' ? '‚úì' : '‚ö†'}</span><span class="toast-message">${msg}</span><button class="toast-close" onclick="this.parentElement.remove()">√ó</button>`; c.appendChild(t); setTimeout(() => t.classList.add('show'), 10
