<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExcelModel - Mod√®les Excel Professionnels</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root{--primary:#0066cc;--primary-dark:#0052a3;--primary-light:#e6f0ff;--secondary:#00a67e;--orange:#f5a623;--purple:#7c3aed;--gray-900:#111827;--gray-800:#1f2937;--gray-700:#374151;--gray-600:#4b5563;--gray-500:#6b7280;--gray-400:#9ca3af;--gray-300:#d1d5db;--gray-200:#e5e7eb;--gray-100:#f3f4f6;--gray-50:#f9fafb;--white:#fff;--danger:#dc2626;--success:#16a34a;--warning:#f59e0b;--shadow:0 1px 3px rgba(0,0,0,0.1);--shadow-md:0 4px 6px -1px rgba(0,0,0,0.1);--shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1);--shadow-xl:0 20px 25px -5px rgba(0,0,0,0.1);--radius:8px;--radius-lg:12px}
        *{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}body{font-family:'Inter',-apple-system,sans-serif;background:var(--white);color:var(--gray-800);line-height:1.6}
        .container{max-width:1280px;margin:0 auto;padding:0 24px}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 24px;border-radius:var(--radius);font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s;text-decoration:none;border:none;font-family:inherit}
        .btn-primary{background:var(--primary);color:var(--white)}.btn-primary:hover{background:var(--primary-dark);box-shadow:var(--shadow-md)}
        .btn-outline{background:var(--white);color:var(--gray-700);border:1px solid var(--gray-300)}.btn-outline:hover{background:var(--gray-50)}
        .btn-ghost{background:transparent;color:var(--gray-600)}.btn-ghost:hover{background:var(--gray-100)}
        .btn-success{background:#25d366;color:var(--white)}.btn-danger{background:var(--danger);color:var(--white)}
        .btn-sm{padding:8px 16px;font-size:13px}.btn-lg{padding:16px 32px;font-size:16px}.btn-block{width:100%}
        .form-group{margin-bottom:20px}.form-label{display:block;margin-bottom:6px;font-weight:500;font-size:14px;color:var(--gray-700)}
        .form-input,.form-textarea,.form-select{width:100%;padding:12px 16px;background:var(--white);border:1px solid var(--gray-300);border-radius:var(--radius);font-size:15px;font-family:inherit;transition:all 0.2s}
        .form-input:focus,.form-textarea:focus,.form-select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(0,102,204,0.1)}
        .form-textarea{min-height:100px;resize:vertical}
        .form-checkbox{display:flex;align-items:center;gap:10px;cursor:pointer;font-size:14px}.form-checkbox input{width:18px;height:18px;accent-color:var(--primary)}
        .icon-picker{position:relative}.icon-picker-btn{width:100%;padding:12px 16px;background:var(--white);border:1px solid var(--gray-300);border-radius:var(--radius);font-size:24px;cursor:pointer;text-align:left;display:flex;align-items:center;gap:10px}
        .icon-picker-btn span{font-size:14px;color:var(--gray-500)}
        .icon-picker-dropdown{position:absolute;top:100%;left:0;right:0;background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius);box-shadow:var(--shadow-lg);padding:12px;display:none;z-index:100;max-height:200px;overflow-y:auto}
        .icon-picker-dropdown.show{display:block}
        .icon-picker-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:8px}
        .icon-picker-item{font-size:24px;padding:8px;text-align:center;cursor:pointer;border-radius:var(--radius);transition:background 0.2s}
        .icon-picker-item:hover{background:var(--gray-100)}
        .navbar{background:var(--white);border-bottom:1px solid var(--gray-200);position:sticky;top:0;z-index:1000}
        .nav-container{display:flex;align-items:center;justify-content:space-between;height:72px}
        .logo{display:flex;align-items:center;gap:10px;text-decoration:none;cursor:pointer}
        .logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--white);font-weight:800;font-size:14px}
        .logo-text{font-size:22px;font-weight:800;color:var(--gray-900)}.logo-text span{color:var(--primary)}
        .nav-links{display:flex;align-items:center;gap:8px}
        .nav-link{padding:8px 16px;color:var(--gray-600);font-weight:500;font-size:15px;border-radius:var(--radius);transition:all 0.2s;cursor:pointer}
        .nav-link:hover{color:var(--primary);background:var(--primary-light)}
        .nav-actions{display:flex;align-items:center;gap:12px}
        .nav-user{display:flex;align-items:center;gap:10px;padding:6px 12px;background:var(--gray-100);border-radius:50px;cursor:pointer}
        .nav-user-avatar{width:32px;height:32px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--white);font-weight:600;font-size:13px}
        .nav-dropdown{position:relative}
        .nav-dropdown-menu{position:absolute;top:calc(100% + 8px);right:0;background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);min-width:200px;box-shadow:var(--shadow-lg);opacity:0;visibility:hidden;transform:translateY(-10px);transition:all 0.2s}
        .nav-dropdown:hover .nav-dropdown-menu{opacity:1;visibility:visible;transform:translateY(0)}
        .nav-dropdown-item{display:flex;align-items:center;gap:10px;padding:12px 16px;color:var(--gray-700);font-size:14px;cursor:pointer;transition:all 0.15s}
        .nav-dropdown-item:hover{background:var(--gray-50);color:var(--primary)}
        .nav-dropdown-divider{height:1px;background:var(--gray-200);margin:4px 0}
        .mobile-menu-btn{display:none;background:none;border:none;font-size:24px;cursor:pointer}
        .page{display:none}.page.active{display:block}
        .hero{background:linear-gradient(135deg,#f0f7ff 0%,#e8f4f8 50%,#f0fdf4 100%);padding:80px 0}
        .hero-content{max-width:800px;margin:0 auto;text-align:center}
        .hero-badge{display:inline-flex;align-items:center;gap:8px;background:var(--white);border:1px solid var(--gray-200);padding:8px 16px;border-radius:50px;font-size:14px;font-weight:500;margin-bottom:24px;box-shadow:var(--shadow)}
        .hero-badge-dot{width:8px;height:8px;background:var(--secondary);border-radius:50%}
        .hero h1{font-size:48px;font-weight:800;color:var(--gray-900);line-height:1.15;margin-bottom:20px}
        .hero h1 span{color:var(--primary)}
        .hero-subtitle{font-size:18px;color:var(--gray-600);margin-bottom:32px}
        .hero-actions{display:flex;gap:16px;justify-content:center;flex-wrap:wrap}
        .hero-stats{display:flex;justify-content:center;gap:48px;margin-top:48px;padding-top:32px;border-top:1px solid var(--gray-200)}
        .hero-stat-value{font-size:28px;font-weight:800;color:var(--gray-900)}.hero-stat-label{font-size:14px;color:var(--gray-500)}
        .search-section{padding:32px 0;background:var(--white);border-bottom:1px solid var(--gray-200)}
        .search-box{display:flex;align-items:center;max-width:600px;margin:0 auto;background:var(--white);border:2px solid var(--gray-200);border-radius:50px;padding:6px 6px 6px 24px}
        .search-box:focus-within{border-color:var(--primary)}
        .search-box input{flex:1;border:none;outline:none;font-size:16px;background:transparent}
        .search-btn{background:var(--primary);color:var(--white);border:none;padding:12px 28px;border-radius:50px;font-weight:600;cursor:pointer}
        .search-tags{display:flex;justify-content:center;gap:10px;margin-top:16px;flex-wrap:wrap}
        .search-tag{padding:6px 14px;background:var(--gray-100);border-radius:50px;font-size:13px;color:var(--gray-600);cursor:pointer}
        .search-tag:hover{background:var(--primary-light);color:var(--primary)}
        .section{padding:64px 0}.section-gray{background:var(--gray-50)}
        .section-header{text-align:center;margin-bottom:48px}
        .section-badge{display:inline-flex;background:var(--primary-light);color:var(--primary);padding:6px 14px;border-radius:50px;font-size:13px;font-weight:600;margin-bottom:12px}
        .section-title{font-size:36px;font-weight:800;color:var(--gray-900);margin-bottom:12px}
        .section-subtitle{font-size:16px;color:var(--gray-500);max-width:600px;margin:0 auto}
        .section-header-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;flex-wrap:wrap;gap:16px}
        .section-header-row .section-title{margin-bottom:0;font-size:28px}
        .categories-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px}
        .category-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:24px;text-align:center;cursor:pointer;transition:all 0.2s}
        .category-card:hover{border-color:var(--primary);box-shadow:var(--shadow-md);transform:translateY(-2px)}
        .category-icon{font-size:36px;margin-bottom:12px}.category-name{font-weight:600;font-size:15px;margin-bottom:4px}.category-count{font-size:13px;color:var(--gray-500)}
        .templates-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:24px}
        .template-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);overflow:hidden;cursor:pointer;transition:all 0.25s}
        .template-card:hover{box-shadow:var(--shadow-xl);transform:translateY(-4px)}
        .template-preview{height:180px;background:var(--gray-100);position:relative;display:flex;align-items:center;justify-content:center}
        .template-preview img{width:100%;height:100%;object-fit:cover}
        .template-preview-placeholder{color:var(--gray-400);font-size:48px}
        .template-badge{position:absolute;top:12px;left:12px;padding:5px 10px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase}
        .template-badge.new{background:var(--secondary);color:var(--white)}
        .template-badge.popular{background:var(--orange);color:var(--white)}
        .template-badge.premium{background:var(--purple);color:var(--white)}
        .template-badge.free{background:var(--success);color:var(--white)}
        .template-info{padding:20px}
        .template-category{font-size:12px;color:var(--primary);font-weight:600;text-transform:uppercase;margin-bottom:8px}
        .template-title{font-size:16px;font-weight:600;color:var(--gray-900);margin-bottom:12px;line-height:1.4}
        .template-meta{display:flex;justify-content:space-between}
        .template-stats{display:flex;gap:12px;font-size:13px;color:var(--gray-500)}
        .template-price{font-weight:700;font-size:14px}
        .template-price.free{color:var(--success)}.template-price.paid{color:var(--gray-900)}
        .pagination{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:40px;padding-top:32px;border-top:1px solid var(--gray-200)}
        .pagination-btn{padding:10px 16px;background:var(--white);border:1px solid var(--gray-300);border-radius:var(--radius);font-size:14px;font-weight:500;cursor:pointer;font-family:inherit}
        .pagination-btn:hover:not(:disabled){background:var(--gray-50)}
        .pagination-btn:disabled{opacity:0.5;cursor:not-allowed}
        .pagination-info{padding:10px 20px;font-size:14px;color:var(--gray-600)}
        .filters{display:flex;gap:8px;flex-wrap:wrap}
        .filter-btn{padding:8px 16px;background:var(--white);border:1px solid var(--gray-300);border-radius:50px;font-size:13px;font-weight:500;cursor:pointer;font-family:inherit}
        .filter-btn:hover,.filter-btn.active{background:var(--primary);border-color:var(--primary);color:var(--white)}
        .template-detail{padding:48px 0}
        .template-detail-grid{display:grid;grid-template-columns:1fr 380px;gap:48px}
        .template-detail-image{background:var(--gray-100);border-radius:var(--radius-lg);overflow:hidden;border:1px solid var(--gray-200)}
        .template-detail-image img{width:100%;height:auto}
        .template-detail-image-placeholder{height:400px;display:flex;align-items:center;justify-content:center;color:var(--gray-400);font-size:64px}
        .template-detail-video{margin-top:24px}
        .template-detail-video iframe{width:100%;height:360px;border-radius:var(--radius-lg);border:1px solid var(--gray-200)}
        .template-detail-content h1{font-size:28px;font-weight:800;margin-bottom:16px}
        .template-detail-meta{display:flex;flex-wrap:wrap;gap:20px;margin-bottom:24px;padding-bottom:24px;border-bottom:1px solid var(--gray-200)}
        .template-detail-meta-item{display:flex;align-items:center;gap:8px;font-size:14px;color:var(--gray-600)}
        .template-detail-description{color:var(--gray-600);line-height:1.8}
        .template-keywords{display:flex;flex-wrap:wrap;gap:8px;margin-top:24px}
        .template-keyword{padding:6px 12px;background:var(--gray-100);border-radius:6px;font-size:13px;color:var(--gray-600)}
        .sidebar-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:28px;position:sticky;top:96px;box-shadow:var(--shadow)}
        .sidebar-price{margin-bottom:24px;text-align:center;padding-bottom:24px;border-bottom:1px solid var(--gray-200)}
        .sidebar-price-value{font-size:36px;font-weight:800}.sidebar-price-value.free{color:var(--success)}
        .sidebar-price-label{font-size:14px;color:var(--gray-500);margin-top:4px}
        .sidebar-actions{display:flex;flex-direction:column;gap:12px;margin-bottom:24px}
        .sidebar-features-title{font-weight:600;font-size:14px;margin-bottom:16px}
        .sidebar-feature{display:flex;align-items:center;gap:12px;padding:10px 0;font-size:14px;color:var(--gray-600)}
        .sidebar-feature-icon{color:var(--success)}
        .auth-page{min-height:calc(100vh - 72px);display:flex;align-items:center;justify-content:center;padding:48px 24px;background:var(--gray-50)}
        .auth-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:40px;width:100%;max-width:420px;box-shadow:var(--shadow-lg)}
        .auth-header{text-align:center;margin-bottom:32px}
        .auth-title{font-size:24px;font-weight:800;margin-bottom:8px}.auth-subtitle{color:var(--gray-500)}
        .auth-footer{text-align:center;margin-top:24px;font-size:14px;color:var(--gray-500)}
        .auth-footer a{color:var(--primary);font-weight:500;text-decoration:none}
        .admin-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}
        .admin-tabs{display:flex;gap:8px;margin-bottom:24px;border-bottom:1px solid var(--gray-200);padding-bottom:16px}
        .admin-tab{padding:10px 20px;background:transparent;border:none;font-size:14px;font-weight:500;color:var(--gray-500);cursor:pointer;border-radius:var(--radius);font-family:inherit}
        .admin-tab:hover{background:var(--gray-100)}.admin-tab.active{color:var(--primary);background:var(--primary-light)}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:32px}
        .stat-card{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:24px}
        .stat-card-icon{width:48px;height:48px;border-radius:var(--radius);display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:16px}
        .stat-card-icon.blue{background:var(--primary-light)}.stat-card-icon.green{background:#dcfce7}.stat-card-icon.orange{background:#fef3c7}.stat-card-icon.purple{background:#ede9fe}
        .stat-card-value{font-size:28px;font-weight:800}.stat-card-label{font-size:14px;color:var(--gray-500);margin-top:4px}
        .table-container{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);overflow:hidden}
        .table{width:100%;border-collapse:collapse}
        .table th,.table td{padding:16px 20px;text-align:left;border-bottom:1px solid var(--gray-200)}
        .table th{background:var(--gray-50);font-weight:600;font-size:13px;color:var(--gray-600);text-transform:uppercase}
        .table tr:last-child td{border-bottom:none}.table tr:hover td{background:var(--gray-50)}
        .table-actions{display:flex;gap:8px}
        .table-badge{padding:4px 10px;border-radius:50px;font-size:12px;font-weight:600}
        .table-badge.success{background:#dcfce7;color:var(--success)}.table-badge.danger{background:#fee2e2;color:var(--danger)}
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:2000;display:flex;align-items:center;justify-content:center;padding:24px;opacity:0;visibility:hidden;transition:all 0.2s}
        .modal-overlay.active{opacity:1;visibility:visible}
        .modal{background:var(--white);border-radius:var(--radius-lg);width:100%;max-width:560px;max-height:90vh;overflow-y:auto}
        .modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--gray-200)}
        .modal-title{font-size:18px;font-weight:700}
        .modal-close{background:none;border:none;font-size:24px;color:var(--gray-400);cursor:pointer}
        .modal-body{padding:24px}.modal-footer{display:flex;justify-content:flex-end;gap:12px;padding:20px 24px;border-top:1px solid var(--gray-200)}
        .toast-container{position:fixed;top:88px;right:24px;z-index:3000;display:flex;flex-direction:column;gap:12px}
        .toast{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius-lg);padding:16px 20px;display:flex;align-items:center;gap:12px;min-width:300px;box-shadow:var(--shadow-lg);transform:translateX(120%);transition:transform 0.3s}
        .toast.show{transform:translateX(0)}.toast.success{border-left:4px solid var(--success)}.toast.error{border-left:4px solid var(--danger)}.toast.warning{border-left:4px solid var(--warning)}
        .toast-message{flex:1;font-size:14px}.toast-close{background:none;border:none;color:var(--gray-400);cursor:pointer}
        .empty-state{text-align:center;padding:64px 24px}
        .empty-state-icon{font-size:64px;margin-bottom:16px}
        .empty-state-title{font-size:20px;font-weight:700;margin-bottom:8px}
        .empty-state-text{color:var(--gray-500);margin-bottom:24px}
        .footer{background:var(--gray-900);color:var(--gray-300);padding:64px 0 32px;margin-top:64px}
        .footer-grid{display:grid;grid-template-columns:2fr repeat(3,1fr);gap:48px;margin-bottom:48px}
        .footer-brand .logo-text{color:var(--white)}
        .footer-desc{font-size:14px;line-height:1.7;margin-top:16px;color:var(--gray-400)}
        .footer-title{font-weight:600;font-size:15px;color:var(--white);margin-bottom:20px}
        .footer-links{list-style:none}.footer-links li{margin-bottom:12px}
        .footer-links a{color:var(--gray-400);text-decoration:none;font-size:14px}
        .footer-links a:hover{color:var(--white)}
        .footer-bottom{padding-top:32px;border-top:1px solid var(--gray-700);text-align:center}
        .footer-copy{font-size:14px;color:var(--gray-500)}
        .pricing-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;max-width:800px;margin:0 auto}
        .pricing-card{background:var(--white);border:2px solid var(--gray-200);border-radius:var(--radius-lg);padding:32px;text-align:center}
        .pricing-card.featured{border-color:var(--primary);box-shadow:var(--shadow-xl);position:relative}
        .pricing-card.featured::before{content:'Populaire';position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:var(--primary);color:var(--white);padding:4px 16px;border-radius:50px;font-size:12px;font-weight:600}
        .pricing-card-title{font-size:20px;font-weight:700;margin-bottom:8px}
        .pricing-card-subtitle{font-size:14px;color:var(--gray-500);margin-bottom:24px}
        .pricing-card-price{font-size:40px;font-weight:800}
        .pricing-card-price span{font-size:16px;font-weight:500;color:var(--gray-500)}
        .pricing-card-features{list-style:none;margin:24px 0;text-align:left}
        .pricing-card-features li{display:flex;align-items:center;gap:10px;padding:10px 0;font-size:14px;color:var(--gray-600)}
        .pricing-card-features li::before{content:'‚úì';color:var(--success);font-weight:700}
        .whatsapp-float{position:fixed;bottom:24px;right:24px;z-index:1000;display:flex;align-items:center;gap:12px;background:#25d366;color:var(--white);padding:14px 24px;border-radius:50px;text-decoration:none;font-weight:600;box-shadow:var(--shadow-lg)}
        .whatsapp-float:hover{transform:translateY(-3px)}
        .whatsapp-float svg{width:24px;height:24px;fill:currentColor}
        .loading{display:flex;align-items:center;justify-content:center;padding:40px;color:var(--gray-500)}
        .spinner{width:24px;height:24px;border:3px solid var(--gray-200);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-right:12px}
        @keyframes spin{to{transform:rotate(360deg)}}
        @media(max-width:1024px){.template-detail-grid{grid-template-columns:1fr}.sidebar-card{position:static}.footer-grid{grid-template-columns:repeat(2,1fr)}}
        @media(max-width:768px){.nav-links{display:none}.mobile-menu-btn{display:block}.hero h1{font-size:32px}.hero-stats{flex-direction:column;gap:24px}.section-title{font-size:28px}.templates-grid{grid-template-columns:1fr}.footer-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>
    <a href="https://wa.me/221773684203" target="_blank" class="whatsapp-float"><svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>Besoin d'aide ?</a>
    <nav class="navbar"><div class="container"><div class="nav-container">
        <div class="logo" onclick="App.navigate('home')"><div class="logo-icon">XL</div><span class="logo-text">Excel<span>Model</span></span></div>
        <div class="nav-links"><span class="nav-link" onclick="App.navigate('home')">Accueil</span><span class="nav-link" onclick="App.navigate('templates')">Mod√®les</span><span class="nav-link" onclick="App.navigate('pricing')">Tarifs</span></div>
        <div class="nav-actions" id="navActions"></div>
        <button class="mobile-menu-btn" onclick="App.toggleMobileMenu()">‚ò∞</button>
    </div></div></nav>
    <main id="app">
        <div class="page active" id="page-home">
            <section class="hero"><div class="container"><div class="hero-content">
                <div class="hero-badge"><span class="hero-badge-dot"></span> +5,000 mod√®les professionnels</div>
                <h1>Mod√®les <span>Excel</span> Professionnels</h1>
                <p class="hero-subtitle">T√©l√©chargez des mod√®les Excel pr√™ts √† l'emploi. Tableaux de bord, finances, RH, gestion de projet. 100% √©ditables.</p>
                <div class="hero-actions"><button class="btn btn-primary btn-lg" onclick="App.navigate('templates')">Explorer les Mod√®les</button><button class="btn btn-outline btn-lg" onclick="App.navigate('pricing')">Voir les Tarifs</button></div>
                <div class="hero-stats"><div class="hero-stat"><div class="hero-stat-value">5,000+</div><div class="hero-stat-label">Mod√®les</div></div><div class="hero-stat"><div class="hero-stat-value">50,000+</div><div class="hero-stat-label">Utilisateurs</div></div><div class="hero-stat"><div class="hero-stat-value">4.9/5</div><div class="hero-stat-label">Note moyenne</div></div></div>
            </div></div></section>
            <section class="search-section"><div class="container">
                <div class="search-box"><input type="text" id="searchInput" placeholder="Rechercher un mod√®le..." onkeyup="if(event.key==='Enter')App.search()"><button class="search-btn" onclick="App.search()">Rechercher</button></div>
                <div class="search-tags" id="searchTags"></div>
            </div></section>
            <section class="section"><div class="container">
                <div class="section-header"><div class="section-badge">üìÅ Cat√©gories</div><h2 class="section-title">Parcourir par Cat√©gorie</h2></div>
                <div class="categories-grid" id="categoriesGrid"></div>
            </div></section>
            <section class="section section-gray"><div class="container">
                <div class="section-header-row"><h2 class="section-title">Mod√®les Populaires</h2><button class="btn btn-outline" onclick="App.navigate('templates')">Voir tout ‚Üí</button></div>
                <div class="templates-grid" id="featuredTemplatesGrid"></div>
            </div></section>
        </div>
        <div class="page" id="page-templates"><section class="section"><div class="container">
            <div class="section-header-row"><h2 class="section-title">Tous les Mod√®les</h2><div class="filters" id="templatesFilters"></div></div>
            <div class="templates-grid" id="allTemplatesGrid"></div>
            <div class="pagination" id="pagination"></div>
        </div></section></div>
        <div class="page" id="page-template-detail"><section class="template-detail"><div class="container" id="templateDetail"></div></section></div>
        <div class="page" id="page-login"><div class="auth-page"><div class="auth-card">
            <div class="auth-header"><div class="logo" style="justify-content:center;margin-bottom:16px"><div class="logo-icon">XL</div><span class="logo-text">Excel<span>Model</span></span></div><h1 class="auth-title">Connexion</h1><p class="auth-subtitle">Acc√©dez √† votre compte</p></div>
            <form onsubmit="App.login(event)"><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="loginEmail" required placeholder="votre@email.com"></div><div class="form-group"><label class="form-label">Mot de passe</label><input type="password" class="form-input" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div><button type="submit" class="btn btn-primary btn-block btn-lg">Se connecter</button></form>
            <div class="auth-footer">Pas encore de compte ? <a href="#" onclick="App.navigate('register');return false;">S'inscrire</a></div>
        </div></div></div>
        <div class="page" id="page-register"><div class="auth-page"><div class="auth-card">
            <div class="auth-header"><h1 class="auth-title">Cr√©er un compte</h1><p class="auth-subtitle">Rejoignez ExcelModel</p></div>
            <form onsubmit="App.register(event)"><div class="form-group"><label class="form-label">Nom complet</label><input type="text" class="form-input" id="registerName" required></div><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="registerEmail" required></div><div class="form-group"><label class="form-label">Mot de passe</label><input type="password" class="form-input" id="registerPassword" required minlength="6"></div><button type="submit" class="btn btn-primary btn-block btn-lg">Cr√©er mon compte</button></form>
            <div class="auth-footer">D√©j√† un compte ? <a href="#" onclick="App.navigate('login');return false;">Se connecter</a></div>
        </div></div></div>
        <div class="page" id="page-my-purchases"><section class="section"><div class="container"><h2 class="section-title" style="margin-bottom:32px">Mes Achats</h2><div id="myPurchasesList"></div></div></section></div>
        <div class="page" id="page-admin"><section class="section"><div class="container">
            <div class="admin-header"><h2 class="section-title">Administration</h2><button class="btn btn-primary" onclick="App.openTemplateModal()">+ Nouveau Mod√®le</button></div>
            <div class="stats-grid" id="adminStats"></div>
            <div class="admin-tabs" id="adminTabs"><button class="admin-tab active" data-tab="templates">üìÑ Mod√®les</button><button class="admin-tab" data-tab="categories">üìÅ Cat√©gories</button><button class="admin-tab" data-tab="purchases">üí∞ Achats</button></div>
            <div id="adminContent"></div>
        </div></section></div>
        <div class="page" id="page-pricing"><section class="section"><div class="container">
            <div class="section-header"><div class="section-badge">üíé Tarifs</div><h2 class="section-title">Choisissez Votre Formule</h2></div>
            <div class="pricing-grid">
                <div class="pricing-card"><div class="pricing-card-title">Mensuel</div><div class="pricing-card-subtitle">Parfait pour tester</div><div class="pricing-card-price">9,900 <span>FCFA/mois</span></div><ul class="pricing-card-features"><li>Acc√®s √† tous les mod√®les</li><li>T√©l√©chargements illimit√©s</li><li>Support par email</li></ul><button class="btn btn-outline btn-block btn-lg">Choisir</button></div>
                <div class="pricing-card featured"><div class="pricing-card-title">Annuel</div><div class="pricing-card-subtitle">√âconomisez 50%</div><div class="pricing-card-price">59,000 <span>FCFA/an</span></div><ul class="pricing-card-features"><li>Tout du plan mensuel</li><li>Mod√®les Premium</li><li>Support WhatsApp prioritaire</li></ul><button class="btn btn-primary btn-block btn-lg">Choisir</button></div>
            </div>
        </div></section></div>
    </main>
    <footer class="footer"><div class="container">
        <div class="footer-grid">
            <div class="footer-brand"><div class="logo"><div class="logo-icon">XL</div><span class="logo-text">Excel<span>Model</span></span></div><p class="footer-desc">La premi√®re plateforme de mod√®les Excel professionnels pour les entreprises africaines.</p></div>
            <div><h4 class="footer-title">Cat√©gories</h4><ul class="footer-links"><li><a href="#">Tableaux de bord</a></li><li><a href="#">Finance</a></li><li><a href="#">RH & Paie</a></li></ul></div>
            <div><h4 class="footer-title">Entreprise</h4><ul class="footer-links"><li><a href="#">√Ä propos</a></li><li><a href="#">Blog</a></li><li><a href="#">Contact</a></li></ul></div>
            <div><h4 class="footer-title">Support</h4><ul class="footer-links"><li><a href="https://wa.me/221773684203">WhatsApp</a></li><li><a href="mailto:sawadgsalif@gmail.com">Email</a></li></ul></div>
        </div>
        <div class="footer-bottom"><p class="footer-copy">¬© 2026 ExcelModel | sawadgsalif@gmail.com | +221 77 368 42 03</p></div>
    </div></footer>
    
    <!-- MODALS -->
    <div class="modal-overlay" id="templateModal"><div class="modal" style="max-width:640px">
        <div class="modal-header"><h2 class="modal-title" id="templateModalTitle">Nouveau Mod√®le</h2><button class="modal-close" onclick="App.closeModal('templateModal')">√ó</button></div>
        <div class="modal-body"><form id="templateForm" onsubmit="App.saveTemplate(event)">
            <input type="hidden" id="templateId">
            <div class="form-group"><label class="form-label">Titre *</label><input type="text" class="form-input" id="templateTitle" required></div>
            <div class="form-group"><label class="form-label">Cat√©gorie *</label><select class="form-select" id="templateCategoryId" required></select></div>
            <div class="form-group"><label class="form-label">Description courte</label><input type="text" class="form-input" id="templateShortDesc"></div>
            <div class="form-group"><label class="form-label">Description compl√®te</label><textarea class="form-textarea" id="templateDescription"></textarea></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
                <div class="form-group"><label class="form-label">Prix (FCFA)</label><input type="number" class="form-input" id="templatePrice" value="0" min="0"></div>
                <div class="form-group"><label class="form-label">Badge</label><select class="form-select" id="templateBadge"><option value="">Aucun</option><option value="new">Nouveau</option><option value="popular">Populaire</option><option value="premium">Premium</option></select></div>
            </div>
            <div class="form-group"><label class="form-label">URL Image aper√ßu</label><input type="url" class="form-input" id="templateImageUrl" placeholder="https://..."></div>
            <div class="form-group"><label class="form-label">URL Fichier Excel</label><input type="url" class="form-input" id="templateFileUrl" placeholder="https://..."></div>
            <div class="form-group"><label class="form-label">URL Vid√©o YouTube</label><input type="url" class="form-input" id="templateVideoUrl" placeholder="https://youtube.com/watch?v=..."></div>
            <div class="form-group"><label class="form-label">Mots-cl√©s (s√©par√©s par virgule)</label><input type="text" class="form-input" id="templateKeywords" placeholder="budget, finance, tableau"></div>
            <div style="display:flex;gap:20px"><label class="form-checkbox"><input type="checkbox" id="templateIsFree"> Gratuit</label><label class="form-checkbox"><input type="checkbox" id="templateIsFeatured"> Mis en avant</label><label class="form-checkbox"><input type="checkbox" id="templateIsActive" checked> Actif</label></div>
        </form></div>
        <div class="modal-footer"><button class="btn btn-outline" onclick="App.closeModal('templateModal')">Annuler</button><button class="btn btn-primary" onclick="document.getElementById('templateForm').requestSubmit()">Enregistrer</button></div>
    </div></div>
    
    <div class="modal-overlay" id="categoryModal"><div class="modal">
        <div class="modal-header"><h2 class="modal-title" id="categoryModalTitle">Nouvelle Cat√©gorie</h2><button class="modal-close" onclick="App.closeModal('categoryModal')">√ó</button></div>
        <div class="modal-body"><form id="categoryForm" onsubmit="App.saveCategory(event)">
            <input type="hidden" id="categoryId">
            <div class="form-group"><label class="form-label">Nom *</label><input type="text" class="form-input" id="categoryName" required></div>
            <div class="form-group"><label class="form-label">Ic√¥ne</label>
                <div class="icon-picker" id="iconPicker">
                    <button type="button" class="icon-picker-btn" onclick="App.toggleIconPicker()"><span id="selectedIcon">üìÅ</span> <span>Cliquer pour choisir</span></button>
                    <div class="icon-picker-dropdown" id="iconPickerDropdown">
                        <div class="icon-picker-grid" id="iconPickerGrid"></div>
                    </div>
                </div>
                <input type="hidden" id="categoryIcon" value="üìÅ">
            </div>
            <div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="categoryDescription"></textarea></div>
            <div class="form-group"><label class="form-label">Ordre d'affichage</label><input type="number" class="form-input" id="categoryOrder" value="0" min="0"></div>
        </form></div>
        <div class="modal-footer"><button class="btn btn-outline" onclick="App.closeModal('categoryModal')">Annuler</button><button class="btn btn-primary" onclick="document.getElementById('categoryForm').requestSubmit()">Enregistrer</button></div>
    </div></div>
    
    <div class="modal-overlay" id="confirmModal"><div class="modal" style="max-width:400px">
        <div class="modal-header"><h2 class="modal-title">Confirmation</h2><button class="modal-close" onclick="App.closeModal('confirmModal')">√ó</button></div>
        <div class="modal-body"><p id="confirmMessage">√ätes-vous s√ªr ?</p></div>
        <div class="modal-footer"><button class="btn btn-outline" onclick="App.closeModal('confirmModal')">Annuler</button><button class="btn btn-danger" id="confirmBtn">Supprimer</button></div>
    </div></div>
<script>
// =============================================
// CONFIGURATION SUPABASE
// =============================================
const SUPABASE_URL = 'https://nnkkeetruqonyjykuxre.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ua2tlZXRydXFvbnlqeWt1eHJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMTQyMDAsImV4cCI6MjA4Mzg5MDIwMH0.y24yrgbRkg5PjU_HQ6O3nZxXOpv9yN5OLCYAuwu1gAo';
const ADMIN_EMAIL = 'sawadgsalif@gmail.com';
const ITEMS_PER_PAGE = 9;
const ICONS = ['üìä','üí∞','üìÖ','üë•','üì¶','üßæ','üìà','üìâ','üíµ','üí≥','üè¶','üìã','üìù','‚úÖ','‚ö°','üéØ','üîß','‚öôÔ∏è','üìÅ','üóÇÔ∏è','üíº','üè¢','üõí','üõçÔ∏è','üì±','üíª','üñ•Ô∏è','üåê','üîí','üîë'];

// =============================================
// APPLICATION
// =============================================
const App = {
    supabase: null,
    user: null,
    profile: null,
    categories: [],
    templates: [],
    filteredTemplates: [],
    currentPage: 1,
    currentTab: 'templates',
    currentFilter: 'all',
    loading: false,

    async init() {
        this.supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // V√©rifier session existante
        const { data: { session } } = await this.supabase.auth.getSession();
        if (session) {
            this.user = session.user;
            await this.loadProfile();
        }
        
        // √âcouter changements auth
        this.supabase.auth.onAuthStateChange(async (event, session) => {
            console.log('Auth event:', event);
            if (event === 'SIGNED_IN' && session) {
                this.user = session.user;
                await this.loadProfile();
            } else if (event === 'SIGNED_OUT') {
                this.user = null;
                this.profile = null;
            }
            this.updateNav();
        });
        
        // Charger donn√©es
        await this.loadCategories();
        await this.loadTemplates();
        this.filteredTemplates = [...this.templates];
        
        // Render UI
        this.updateNav();
        this.renderCategories();
        this.renderFeaturedTemplates();
        this.renderSearchTags();
        this.renderIconPicker();
        this.handleRoute();
        this.setupEvents();
    },

    setupEvents() {
        window.addEventListener('popstate', () => this.handleRoute());
        document.getElementById('adminTabs')?.addEventListener('click', (e) => {
            if (e.target.classList.contains('admin-tab')) {
                document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                this.currentTab = e.target.dataset.tab;
                this.renderAdminContent();
            }
        });
        // Fermer icon picker si clic en dehors
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.icon-picker')) {
                document.getElementById('iconPickerDropdown')?.classList.remove('show');
            }
        });
    },

    // =============================================
    // CHARGEMENT DONN√âES
    // =============================================
    async loadProfile() {
        if (!this.user) return;
        try {
            const { data, error } = await this.supabase
                .from('profiles')
                .select('*')
                .eq('id', this.user.id)
                .single();
            if (data) this.profile = data;
            console.log('Profile loaded:', this.profile);
        } catch (e) {
            console.error('Error loading profile:', e);
        }
    },

    async loadCategories() {
        try {
            const { data, error } = await this.supabase
                .from('categories')
                .select('*')
                .eq('is_active', true)
                .order('display_order', { ascending: true });
            if (error) throw error;
            this.categories = data || [];
            console.log('Categories loaded:', this.categories.length);
        } catch (e) {
            console.error('Error loading categories:', e);
            this.categories = [];
        }
    },

    async loadTemplates() {
        try {
            const { data, error } = await this.supabase
                .from('templates')
                .select('*, categories(name, icon)')
                .eq('is_active', true)
                .order('created_at', { ascending: false });
            if (error) throw error;
            this.templates = (data || []).map(t => ({
                ...t,
                category_name: t.categories?.name,
                category_icon: t.categories?.icon
            }));
            console.log('Templates loaded:', this.templates.length);
        } catch (e) {
            console.error('Error loading templates:', e);
            this.templates = [];
        }
    },

    // =============================================
    // NAVIGATION
    // =============================================
    navigate(page, params = {}) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const el = document.getElementById('page-' + page);
        if (el) el.classList.add('active');
        const url = new URL(window.location);
        url.searchParams.set('page', page);
        Object.entries(params).forEach(([k, v]) => v ? url.searchParams.set(k, v) : url.searchParams.delete(k));
        window.history.pushState({}, '', url);
        this.onPageChange(page, params);
        window.scrollTo(0, 0);
    },

    handleRoute() {
        const url = new URL(window.location);
        const page = url.searchParams.get('page') || 'home';
        const slug = url.searchParams.get('slug');
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const el = document.getElementById('page-' + page);
        if (el) el.classList.add('active');
        this.onPageChange(page, { slug });
    },

    onPageChange(page, params) {
        switch(page) {
            case 'home':
                this.renderCategories();
                this.renderFeaturedTemplates();
                break;
            case 'templates':
                this.currentPage = 1;
                this.currentFilter = 'all';
                this.filteredTemplates = [...this.templates];
                this.renderAllTemplates();
                break;
            case 'template-detail':
                this.renderTemplateDetail(params.slug);
                break;
            case 'admin':
                if (this.isAdmin()) this.renderAdmin();
                else { this.toast('Acc√®s refus√©', 'error'); this.navigate('home'); }
                break;
            case 'my-purchases':
                if (this.user) this.renderPurchases();
                else this.navigate('login');
                break;
        }
    },

    // =============================================
    // RENDER UI
    // =============================================
    updateNav() {
        const nav = document.getElementById('navActions');
        if (this.user) {
            const initials = this.getInitials(this.profile?.full_name || this.user.email);
            const isAdm = this.isAdmin();
            nav.innerHTML = '<div class="nav-dropdown"><div class="nav-user"><div class="nav-user-avatar">' + initials + '</div></div><div class="nav-dropdown-menu"><div class="nav-dropdown-item" onclick="App.navigate(\'my-purchases\')">üì¶ Mes achats</div>' + (isAdm ? '<div class="nav-dropdown-item" onclick="App.navigate(\'admin\')">‚öôÔ∏è Administration</div>' : '') + '<div class="nav-dropdown-divider"></div><div class="nav-dropdown-item" onclick="App.logout()">üö™ D√©connexion</div></div></div>';
        } else {
            nav.innerHTML = '<button class="btn btn-ghost" onclick="App.navigate(\'login\')">Connexion</button><button class="btn btn-primary" onclick="App.navigate(\'register\')">S\'inscrire</button>';
        }
    },

    renderCategories() {
        const grid = document.getElementById('categoriesGrid');
        if (!grid) return;
        if (this.categories.length === 0) {
            grid.innerHTML = '<p style="color:var(--gray-500);text-align:center;grid-column:1/-1">Aucune cat√©gorie disponible</p>';
            return;
        }
        grid.innerHTML = this.categories.map(c => 
            '<div class="category-card" onclick="App.filterByCategory(\'' + c.id + '\')">' +
            '<div class="category-icon">' + (c.icon || 'üìÅ') + '</div>' +
            '<div class="category-name">' + c.name + '</div>' +
            '<div class="category-count">' + this.templates.filter(t => t.category_id === c.id).length + ' mod√®les</div>' +
            '</div>'
        ).join('');
    },

    renderSearchTags() {
        const tags = document.getElementById('searchTags');
        if (!tags) return;
        const popular = ['Dashboard', 'Budget', 'Paie', 'Gantt', 'Stock', 'Factures'];
        tags.innerHTML = popular.map(t => '<span class="search-tag" onclick="App.searchTag(\'' + t + '\')">' + t + '</span>').join('');
    },

    renderFeaturedTemplates() {
        const grid = document.getElementById('featuredTemplatesGrid');
        if (!grid) return;
        if (this.templates.length === 0) {
            grid.innerHTML = '<p style="color:var(--gray-500);text-align:center;grid-column:1/-1">Aucun mod√®le disponible</p>';
            return;
        }
        const featured = this.templates.filter(t => t.is_featured || t.badge).slice(0, 6);
        const toShow = featured.length > 0 ? featured : this.templates.slice(0, 6);
        grid.innerHTML = toShow.map(t => this.templateCard(t)).join('');
    },

    renderAllTemplates() {
        const grid = document.getElementById('allTemplatesGrid');
        const filters = document.getElementById('templatesFilters');
        const pagination = document.getElementById('pagination');
        if (!grid) return;
        
        const totalPages = Math.ceil(this.filteredTemplates.length / ITEMS_PER_PAGE);
        const start = (this.currentPage - 1) * ITEMS_PER_PAGE;
        const pageTemplates = this.filteredTemplates.slice(start, start + ITEMS_PER_PAGE);
        
        grid.innerHTML = pageTemplates.length 
            ? pageTemplates.map(t => this.templateCard(t)).join('') 
            : '<div class="empty-state" style="grid-column:1/-1"><div class="empty-state-icon">üîç</div><h3 class="empty-state-title">Aucun mod√®le trouv√©</h3></div>';
        
        if (filters) {
            filters.innerHTML = '<button class="filter-btn ' + (this.currentFilter === 'all' ? 'active' : '') + '" onclick="App.filter(\'all\')">Tous</button>' + 
                this.categories.map(c => '<button class="filter-btn ' + (this.currentFilter === c.id ? 'active' : '') + '" onclick="App.filter(\'' + c.id + '\')">' + c.name + '</button>').join('');
        }
        
        if (pagination && totalPages > 1) {
            pagination.innerHTML = '<button class="pagination-btn" onclick="App.goToPage(' + (this.currentPage - 1) + ')" ' + (this.currentPage === 1 ? 'disabled' : '') + '>‚Üê Pr√©c√©dent</button>' +
                '<span class="pagination-info">Page ' + this.currentPage + ' / ' + totalPages + '</span>' +
                '<button class="pagination-btn" onclick="App.goToPage(' + (this.currentPage + 1) + ')" ' + (this.currentPage === totalPages ? 'disabled' : '') + '>Suivant ‚Üí</button>';
        } else if (pagination) {
            pagination.innerHTML = '';
        }
    },

    templateCard(t) {
        const badge = t.badge === 'popular' ? 'Populaire' : t.badge === 'new' ? 'Nouveau' : t.badge === 'premium' ? 'Premium' : t.is_free ? 'Gratuit' : '';
        const badgeClass = t.badge || (t.is_free ? 'free' : '');
        return '<div class="template-card" onclick="App.navigate(\'template-detail\', { slug: \'' + t.slug + '\' })">' +
            '<div class="template-preview">' +
            (badge ? '<span class="template-badge ' + badgeClass + '">' + badge + '</span>' : '') +
            (t.preview_image_url ? '<img src="' + t.preview_image_url + '" alt="' + t.title + '">' : '<div class="template-preview-placeholder">üìÑ</div>') +
            '</div><div class="template-info">' +
            '<div class="template-category">' + (t.category_name || 'Non class√©') + '</div>' +
            '<h3 class="template-title">' + t.title + '</h3>' +
            '<div class="template-meta"><div class="template-stats"><span>‚¨á ' + this.formatNum(t.downloads_count || 0) + '</span><span>‚òÖ ' + (t.rating_average || 0) + '</span></div>' +
            '<span class="template-price ' + (t.is_free ? 'free' : 'paid') + '">' + (t.is_free ? 'Gratuit' : this.formatPrice(t.price)) + '</span></div></div></div>';
    },

    renderTemplateDetail(slug) {
        const container = document.getElementById('templateDetail');
        const t = this.templates.find(x => x.slug === slug);
        if (!t) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîç</div><h3 class="empty-state-title">Mod√®le non trouv√©</h3><button class="btn btn-primary" onclick="App.navigate(\'templates\')">Voir tous les mod√®les</button></div>';
            return;
        }
        const video = t.video_url ? this.getVideoEmbed(t.video_url) : '';
        container.innerHTML = '<div class="template-detail-grid"><div>' +
            '<div class="template-detail-image">' + (t.preview_image_url ? '<img src="' + t.preview_image_url + '" alt="' + t.title + '">' : '<div class="template-detail-image-placeholder">üìÑ</div>') + '</div>' +
            (video ? '<div class="template-detail-video">' + video + '</div>' : '') +
            '<div class="template-detail-content" style="margin-top:32px"><h1>' + t.title + '</h1>' +
            '<div class="template-detail-meta">' +
            '<div class="template-detail-meta-item">üìÅ ' + (t.category_name || 'Non class√©') + '</div>' +
            '<div class="template-detail-meta-item">‚¨á ' + this.formatNum(t.downloads_count || 0) + ' t√©l√©chargements</div>' +
            '<div class="template-detail-meta-item">‚òÖ ' + (t.rating_average || 0) + '/5</div></div>' +
            '<div class="template-detail-description">' + (t.description || t.short_description || 'Aucune description disponible.') + '</div>' +
            (t.keywords && t.keywords.length ? '<div class="template-keywords">' + t.keywords.map(k => '<span class="template-keyword">' + k + '</span>').join('') + '</div>' : '') +
            '</div></div>' +
            '<div><div class="sidebar-card">' +
            '<div class="sidebar-price"><div class="sidebar-price-value ' + (t.is_free ? 'free' : '') + '">' + (t.is_free ? 'Gratuit' : this.formatPrice(t.price)) + '</div>' +
            (!t.is_free ? '<div class="sidebar-price-label">Prix unique</div>' : '') + '</div>' +
            '<div class="sidebar-actions">' +
            (t.is_free ? '<button class="btn btn-primary btn-block btn-lg" onclick="App.download(\'' + t.id + '\')">‚¨á T√©l√©charger</button>' : '<button class="btn btn-primary btn-block btn-lg" onclick="App.purchase(\'' + t.id + '\')">üí≥ Acheter</button>') +
            '<a href="https://wa.me/221773684203?text=' + encodeURIComponent('Question sur: ' + t.title) + '" target="_blank" class="btn btn-success btn-block">üí¨ WhatsApp</a>' +
            '<button class="btn btn-outline btn-block" onclick="App.navigate(\'templates\')">‚Üê Retour</button></div>' +
            '<div class="sidebar-features"><div class="sidebar-features-title">Ce qui est inclus :</div>' +
            '<div class="sidebar-feature"><span class="sidebar-feature-icon">‚úì</span> Fichier Excel (.xlsx)</div>' +
            '<div class="sidebar-feature"><span class="sidebar-feature-icon">‚úì</span> 100% √©ditable</div>' +
            '<div class="sidebar-feature"><span class="sidebar-feature-icon">‚úì</span> Formules automatiques</div>' +
            '<div class="sidebar-feature"><span class="sidebar-feature-icon">‚úì</span> Support par email</div></div>' +
            '</div></div></div>';
    },

    // =============================================
    // ADMIN
    // =============================================
    isAdmin() {
        return this.user?.email === ADMIN_EMAIL || this.profile?.role === 'admin';
    },

    renderAdmin() {
        document.getElementById('adminStats').innerHTML = 
            '<div class="stat-card"><div class="stat-card-icon blue">üìÑ</div><div class="stat-card-value">' + this.templates.length + '</div><div class="stat-card-label">Mod√®les</div></div>' +
            '<div class="stat-card"><div class="stat-card-icon green">üìÅ</div><div class="stat-card-value">' + this.categories.length + '</div><div class="stat-card-label">Cat√©gories</div></div>' +
            '<div class="stat-card"><div class="stat-card-icon orange">üí∞</div><div class="stat-card-value">0</div><div class="stat-card-label">Ventes</div></div>' +
            '<div class="stat-card"><div class="stat-card-icon purple">üë•</div><div class="stat-card-value">0</div><div class="stat-card-label">Utilisateurs</div></div>';
        this.renderAdminContent();
    },

    renderAdminContent() {
        const content = document.getElementById('adminContent');
        if (this.currentTab === 'templates') {
            content.innerHTML = '<div class="table-container"><table class="table"><thead><tr><th>Titre</th><th>Cat√©gorie</th><th>Prix</th><th>Statut</th><th>Actions</th></tr></thead><tbody>' +
                (this.templates.length ? this.templates.map(t => 
                    '<tr><td><strong>' + t.title + '</strong></td>' +
                    '<td>' + (t.category_name || '-') + '</td>' +
                    '<td>' + (t.is_free ? '<span class="table-badge success">Gratuit</span>' : this.formatPrice(t.price)) + '</td>' +
                    '<td><span class="table-badge ' + (t.is_active ? 'success' : 'danger') + '">' + (t.is_active ? 'Actif' : 'Inactif') + '</span></td>' +
                    '<td><div class="table-actions"><button class="btn btn-sm btn-ghost" onclick="App.editTemplate(\'' + t.id + '\')">‚úèÔ∏è</button><button class="btn btn-sm btn-ghost" onclick="App.confirmDelete(\'template\',\'' + t.id + '\')">üóëÔ∏è</button></div></td></tr>'
                ).join('') : '<tr><td colspan="5" style="text-align:center;color:var(--gray-500)">Aucun mod√®le</td></tr>') +
                '</tbody></table></div>';
        } else if (this.currentTab === 'categories') {
            content.innerHTML = '<div style="margin-bottom:16px"><button class="btn btn-primary" onclick="App.openCategoryModal()">+ Nouvelle Cat√©gorie</button></div>' +
                '<div class="table-container"><table class="table"><thead><tr><th>Ic√¥ne</th><th>Nom</th><th>Ordre</th><th>Actions</th></tr></thead><tbody>' +
                (this.categories.length ? this.categories.map(c => 
                    '<tr><td style="font-size:28px">' + (c.icon || 'üìÅ') + '</td>' +
                    '<td><strong>' + c.name + '</strong></td>' +
                    '<td>' + (c.display_order || 0) + '</td>' +
                    '<td><div class="table-actions"><button class="btn btn-sm btn-ghost" onclick="App.editCategory(\'' + c.id + '\')">‚úèÔ∏è</button><button class="btn btn-sm btn-ghost" onclick="App.confirmDelete(\'category\',\'' + c.id + '\')">üóëÔ∏è</button></div></td></tr>'
                ).join('') : '<tr><td colspan="4" style="text-align:center;color:var(--gray-500)">Aucune cat√©gorie</td></tr>') +
                '</tbody></table></div>';
        } else {
            content.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí∞</div><h3 class="empty-state-title">Achats</h3><p class="empty-state-text">Les achats appara√Ætront ici</p></div>';
        }
    },

    // =============================================
    // ICON PICKER
    // =============================================
    renderIconPicker() {
        const grid = document.getElementById('iconPickerGrid');
        if (!grid) return;
        grid.innerHTML = ICONS.map(icon => 
            '<div class="icon-picker-item" onclick="App.selectIcon(\'' + icon + '\')">' + icon + '</div>'
        ).join('');
    },

    toggleIconPicker() {
        const dropdown = document.getElementById('iconPickerDropdown');
        dropdown.classList.toggle('show');
    },

    selectIcon(icon) {
        document.getElementById('selectedIcon').textContent = icon;
        document.getElementById('categoryIcon').value = icon;
        document.getElementById('iconPickerDropdown').classList.remove('show');
    },

    // =============================================
    // MODALS
    // =============================================
    openTemplateModal(t = null) {
        document.getElementById('templateModalTitle').textContent = t ? 'Modifier le Mod√®le' : 'Nouveau Mod√®le';
        document.getElementById('templateId').value = t?.id || '';
        document.getElementById('templateTitle').value = t?.title || '';
        document.getElementById('templateShortDesc').value = t?.short_description || '';
        document.getElementById('templateDescription').value = t?.description || '';
        document.getElementById('templatePrice').value = t?.price || 0;
        document.getElementById('templateBadge').value = t?.badge || '';
        document.getElementById('templateImageUrl').value = t?.preview_image_url || '';
        document.getElementById('templateFileUrl').value = t?.file_url || '';
        document.getElementById('templateVideoUrl').value = t?.video_url || '';
        document.getElementById('templateKeywords').value = t?.keywords?.join(', ') || '';
        document.getElementById('templateIsFree').checked = t?.is_free || false;
        document.getElementById('templateIsFeatured').checked = t?.is_featured || false;
        document.getElementById('templateIsActive').checked = t?.is_active !== false;
        document.getElementById('templateCategoryId').innerHTML = this.categories.map(c => 
            '<option value="' + c.id + '"' + (t?.category_id === c.id ? ' selected' : '') + '>' + (c.icon || 'üìÅ') + ' ' + c.name + '</option>'
        ).join('');
        document.getElementById('templateModal').classList.add('active');
    },

    openCategoryModal(c = null) {
        document.getElementById('categoryModalTitle').textContent = c ? 'Modifier la Cat√©gorie' : 'Nouvelle Cat√©gorie';
        document.getElementById('categoryId').value = c?.id || '';
        document.getElementById('categoryName').value = c?.name || '';
        document.getElementById('categoryIcon').value = c?.icon || 'üìÅ';
        document.getElementById('selectedIcon').textContent = c?.icon || 'üìÅ';
        document.getElementById('categoryDescription').value = c?.description || '';
        document.getElementById('categoryOrder').value = c?.display_order || 0;
        document.getElementById('categoryModal').classList.add('active');
    },

    closeModal(id) {
        document.getElementById(id).classList.remove('active');
    },

    confirmDelete(type, id) {
        document.getElementById('confirmMessage').textContent = '√ätes-vous s√ªr de vouloir supprimer ' + (type === 'template' ? 'ce mod√®le' : 'cette cat√©gorie') + ' ?';
        document.getElementById('confirmBtn').onclick = () => {
            if (type === 'template') this.deleteTemplate(id);
            else this.deleteCategory(id);
            this.closeModal('confirmModal');
        };
        document.getElementById('confirmModal').classList.add('active');
    },

    // =============================================
    // CRUD OPERATIONS
    // =============================================
    async saveTemplate(e) {
        e.preventDefault();
        const id = document.getElementById('templateId').value;
        const data = {
            title: document.getElementById('templateTitle').value,
            slug: this.slugify(document.getElementById('templateTitle').value),
            category_id: document.getElementById('templateCategoryId').value,
            short_description: document.getElementById('templateShortDesc').value || null,
            description: document.getElementById('templateDescription').value || null,
            price: parseFloat(document.getElementById('templatePrice').value) || 0,
            badge: document.getElementById('templateBadge').value || null,
            preview_image_url: document.getElementById('templateImageUrl').value || null,
            file_url: document.getElementById('templateFileUrl').value || null,
            video_url: document.getElementById('templateVideoUrl').value || null,
            keywords: document.getElementById('templateKeywords').value ? document.getElementById('templateKeywords').value.split(',').map(k => k.trim()).filter(k => k) : [],
            is_free: document.getElementById('templateIsFree').checked,
            is_featured: document.getElementById('templateIsFeatured').checked,
            is_active: document.getElementById('templateIsActive').checked
        };
        
        try {
            let result;
            if (id) {
                result = await this.supabase.from('templates').update(data).eq('id', id);
            } else {
                result = await this.supabase.from('templates').insert(data);
            }
            if (result.error) throw result.error;
            
            await this.loadTemplates();
            this.filteredTemplates = [...this.templates];
            this.closeModal('templateModal');
            this.renderAdmin();
            this.toast('Mod√®le enregistr√© !', 'success');
        } catch (err) {
            console.error('Save template error:', err);
            this.toast('Erreur: ' + err.message, 'error');
        }
    },

    async saveCategory(e) {
        e.preventDefault();
        const id = document.getElementById('categoryId').value;
        const data = {
            name: document.getElementById('categoryName').value,
            slug: this.slugify(document.getElementById('categoryName').value),
            icon: document.getElementById('categoryIcon').value || 'üìÅ',
            description: document.getElementById('categoryDescription').value || null,
            display_order: parseInt(document.getElementById('categoryOrder').value) || 0,
            is_active: true
        };
        
        try {
            let result;
            if (id) {
                result = await this.supabase.from('categories').update(data).eq('id', id);
            } else {
                result = await this.supabase.from('categories').insert(data);
            }
            if (result.error) throw result.error;
            
            await this.loadCategories();
            this.closeModal('categoryModal');
            this.renderCategories();
            this.renderAdmin();
            this.toast('Cat√©gorie enregistr√©e !', 'success');
        } catch (err) {
            console.error('Save category error:', err);
            this.toast('Erreur: ' + err.message, 'error');
        }
    },

    editTemplate(id) {
        const t = this.templates.find(x => x.id === id);
        if (t) this.openTemplateModal(t);
    },

    editCategory(id) {
        const c = this.categories.find(x => x.id === id);
        if (c) this.openCategoryModal(c);
    },

    async deleteTemplate(id) {
        try {
            const { error } = await this.supabase.from('templates').delete().eq('id', id);
            if (error) throw error;
            await this.loadTemplates();
            this.filteredTemplates = [...this.templates];
            this.renderAdmin();
            this.toast('Mod√®le supprim√©', 'success');
        } catch (err) {
            this.toast('Erreur: ' + err.message, 'error');
        }
    },

    async deleteCategory(id) {
        try {
            const { error } = await this.supabase.from('categories').delete().eq('id', id);
            if (error) throw error;
            await this.loadCategories();
            this.renderCategories();
            this.renderAdmin();
            this.toast('Cat√©gorie supprim√©e', 'success');
        } catch (err) {
            this.toast('Erreur: ' + err.message, 'error');
        }
    },

    // =============================================
    // AUTH
    // =============================================
    async login(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        try {
            const { data, error } = await this.supabase.auth.signInWithPassword({ email, password });
            if (error) throw error;
            this.toast('Connexion r√©ussie !', 'success');
            this.navigate('home');
        } catch (err) {
            this.toast('Erreur: ' + err.message, 'error');
        }
    },

    async register(e) {
        e.preventDefault();
        const name = document.getElementById('registerName').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        
        try {
            const { data, error } = await this.supabase.auth.signUp({
                email,
                password,
                options: { data: { full_name: name } }
            });
            if (error) throw error;
            this.toast('Compte cr√©√© ! V√©rifiez votre email.', 'success');
            this.navigate('home');
        } catch (err) {
            this.toast('Erreur: ' + err.message, 'error');
        }
    },

    async logout() {
        await this.supabase.auth.signOut();
        this.user = null;
        this.profile = null;
        this.updateNav();
        this.navigate('home');
        this.toast('D√©connexion r√©ussie', 'success');
    },

    // =============================================
    // SEARCH & FILTER
    // =============================================
    search() {
        const q = document.getElementById('searchInput').value.trim().toLowerCase();
        if (q) {
            this.navigate('templates');
            setTimeout(() => {
                this.currentPage = 1;
                this.currentFilter = 'all';
                this.filteredTemplates = this.templates.filter(t => 
                    t.title.toLowerCase().includes(q) || 
                    t.short_description?.toLowerCase().includes(q) ||
                    t.category_name?.toLowerCase().includes(q)
                );
                this.renderAllTemplates();
            }, 100);
        }
    },

    searchTag(tag) {
        document.getElementById('searchInput').value = tag;
        this.search();
    },

    filter(id) {
        this.currentFilter = id;
        this.currentPage = 1;
        this.filteredTemplates = id === 'all' ? [...this.templates] : this.templates.filter(t => t.category_id === id);
        this.renderAllTemplates();
    },

    filterByCategory(id) {
        this.navigate('templates');
        setTimeout(() => this.filter(id), 100);
    },

    goToPage(page) {
        const totalPages = Math.ceil(this.filteredTemplates.length / ITEMS_PER_PAGE);
        if (page >= 1 && page <= totalPages) {
            this.currentPage = page;
            this.renderAllTemplates();
            window.scrollTo({ top: 200, behavior: 'smooth' });
        }
    },

    // =============================================
    // PURCHASE & DOWNLOAD
    // =============================================
    purchase(id) {
        if (!this.user) {
            this.toast('Connectez-vous pour acheter', 'warning');
            this.navigate('login');
            return;
        }
        this.toast('Redirection vers le paiement...', 'success');
        // TODO: Int√©grer paiement Wave/Orange Money
    },

    download(id) {
        const t = this.templates.find(x => x.id === id);
        if (t?.file_url) {
            window.open(t.file_url, '_blank');
            this.toast('T√©l√©chargement d√©marr√© !', 'success');
        } else {
            this.toast('Fichier non disponible', 'error');
        }
    },

    renderPurchases() {
        document.getElementById('myPurchasesList').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¶</div><h3 class="empty-state-title">Aucun achat</h3><p class="empty-state-text">Vos mod√®les achet√©s appara√Ætront ici</p><button class="btn btn-primary" onclick="App.navigate(\'templates\')">Explorer les mod√®les</button></div>';
    },

    // =============================================
    // UTILITIES
    // =============================================
    slugify(str) {
        return str.toString().toLowerCase()
            .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/(^-|-$)/g, '');
    },

    formatPrice(price) {
        return new Intl.NumberFormat('fr-FR').format(price || 0) + ' FCFA';
    },

    formatNum(num) {
        return num >= 1000 ? (num / 1000).toFixed(1) + 'K' : (num || 0).toString();
    },

    getInitials(name) {
        if (!name) return '?';
        return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
    },

    getVideoEmbed(url) {
        if (!url) return '';
        const ytMatch = url.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]+)/);
        if (ytMatch) return '<iframe src="https://www.youtube.com/embed/' + ytMatch[1] + '" allowfullscreen></iframe>';
        return '';
    },

    toast(message, type = 'success') {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = 'toast ' + type;
        toast.innerHTML = '<span>' + (type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚ö†') + '</span><span class="toast-message">' + message + '</span><button class="toast-close" onclick="this.parentElement.remove()">√ó</button>';
        container.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => toast.remove(), 5000);
    },

    toggleMobileMenu() {
        const links = document.querySelector('.nav-links');
        links.style.display = links.style.display === 'flex' ? 'none' : 'flex';
    }
};

// D√©marrer l'application
document.addEventListener('DOMContentLoaded', () => App.init());
</script>
</body>
</html>
